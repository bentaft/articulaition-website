<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="AI-Powered Negotiation Analysis Results - Articulaition"
    />
    <title>Negotiation Analysis Results - Articulaition</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/variables.css" />
    <link rel="stylesheet" href="css/base.css" />

    <style>
      /* ==========================================================================
         NEGOTIATION ANALYSIS DESIGN SYSTEM
         ========================================================================== */
      :root {
        /* Negotiation Color Palette - Strategic & Balanced */
        --negotiation-primary: #7c3aed;
        --negotiation-secondary: #4a90e2;
        --negotiation-accent: #0891b2;
        --negotiation-success: #10b981;
        --negotiation-warning: #f59e0b;
        --negotiation-neutral: #64748b;
        --negotiation-dark: #2d3748;
        --negotiation-light: #f7fafc;
        --negotiation-bg-primary: #fafbfc;
        --negotiation-bg-secondary: #f4f6f8;
        --negotiation-glass: rgba(255, 255, 255, 0.85);
        --negotiation-glass-border: rgba(255, 255, 255, 0.3);
        --negotiation-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08);
        --negotiation-shadow-lg: 0 35px 60px -12px rgba(0, 0, 0, 0.12);
        --negotiation-text-primary: #1a202c;
        --negotiation-text-secondary: #4a5568;
        --negotiation-text-muted: #718096;
        
        /* Negotiation Accent Colors */
        --negotiation-strategy: #7c3aed;
        --negotiation-flexibility: #0891b2;
        --negotiation-assertive: #f59e0b;
        --negotiation-empathy: #10b981;
        --negotiation-tone: #6366f1;
        --negotiation-light-bg: rgba(124, 58, 237, 0.05);
        
        /* Typography */
        --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        
        /* Spacing */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;
        
        /* Radius */
        --radius: 0.75rem;
        --radius-sm: 0.5rem;
        --radius-lg: 1rem;
        
        /* Glass Morphism Shadows */
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      /* ==========================================================================
         BASE STYLES WITH SOPHISTICATED BACKGROUND
         ========================================================================== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: var(--font-sans);
        background: linear-gradient(135deg, #fafbfc 0%, #f4f6f8 25%, #edf2f7 50%, #e2e8f0 75%, #cbd5e0 100%);
        color: var(--negotiation-text-primary);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
      }

      /* Background Effects */
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
          radial-gradient(circle at 20% 20%, rgba(124, 58, 237, 0.03) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(74, 144, 226, 0.025) 0%, transparent 50%),
          radial-gradient(circle at 20% 80%, rgba(8, 145, 178, 0.02) 0%, transparent 50%),
          radial-gradient(circle at 80% 80%, rgba(124, 58, 237, 0.015) 0%, transparent 50%);
        pointer-events: none;
        z-index: -1;
      }

      /* Animation Classes */
      .fade-in {
        animation: fadeIn 1s ease-out forwards;
        opacity: 0;
      }

      .slide-up {
        animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0;
        transform: translateY(30px);
      }

      .scale-in {
        animation: scaleIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0;
        transform: scale(0.9);
      }

      @keyframes fadeIn {
        to { opacity: 1; }
      }
      @keyframes slideUp {
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes scaleIn {
        to { opacity: 1; transform: scale(1); }
      }

      .delay-100 { animation-delay: 0.1s; }
      .delay-200 { animation-delay: 0.2s; }
      .delay-300 { animation-delay: 0.3s; }
      .delay-400 { animation-delay: 0.4s; }
      .delay-500 { animation-delay: 0.5s; }

      /* ==========================================================================
         TOP NAVIGATION WITH GLASS MORPHISM
         ========================================================================== */
      .top-nav {
        padding: 1.5rem 2.5rem;
        background: var(--negotiation-glass);
        backdrop-filter: blur(25px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--negotiation-shadow);
      }

      .logo-section {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .logo-section img {
        height: 36px;
        filter: none;
        transition: transform 0.3s ease;
      }

      .logo-section:hover img {
        transform: scale(1.05);
      }

      /* Navigation Branding with Shiny Effect */
      .nav-orange {
          background: linear-gradient(
              145deg,
              #ff934d 0%,
              #ffb366 30%,
              #ff7f50 60%,
              #ff934d 100%
          );
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          filter: drop-shadow(0 2px 4px rgba(255, 147, 77, 0.3));
      }

      .nav-blue {
          background: linear-gradient(
              145deg,
              #4a90e2 0%,
              #6bb6ff 30%,
              #4f94e8 60%,
              #4a90e2 100%
          );
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          filter: drop-shadow(0 2px 4px rgba(74, 144, 226, 0.3));
      }

      .nav-links {
        display: flex;
        gap: 2rem;
      }

      .nav-link {
        color: var(--negotiation-text-secondary);
        text-decoration: none;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        position: relative;
      }

      .nav-link.active {
        color: var(--negotiation-primary);
        background: transparent;
        border: none;
        border-bottom: 2px solid var(--negotiation-primary);
        border-radius: 0;
        padding-bottom: 0.4rem;
      }

      .nav-link:hover:not(.active) {
        color: var(--negotiation-text-primary);
        background: rgba(0, 0, 0, 0.05);
      }

      .user-menu {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--negotiation-primary),
          var(--negotiation-secondary)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.875rem;
      }

      .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, var(--negotiation-primary), var(--negotiation-secondary));
        color: white;
        text-decoration: none;
        border-radius: 12px;
        font-weight: 500;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
      }

      .back-btn:hover {
        background: linear-gradient(135deg, var(--negotiation-secondary), var(--negotiation-primary));
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      /* ==========================================================================
         MAIN CONTENT LAYOUT
         ========================================================================== */
      .main-content {
        max-width: 1400px;
        margin: 0 auto;
        padding: 3rem 2rem;
        position: relative;
        z-index: 2;
      }

      .breadcrumb {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 2rem;
        color: var(--negotiation-text-muted);
        font-size: 0.875rem;
      }

      .breadcrumb a {
        color: var(--negotiation-text-muted);
        text-decoration: none;
      }

      .breadcrumb a:hover {
        color: var(--negotiation-text-secondary);
      }

      .breadcrumb .current {
        color: var(--negotiation-text-primary);
        font-weight: 500;
      }

      .page-title-section {
        text-align: center;
        margin-bottom: 3rem;
      }

      .title-with-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .title-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background: linear-gradient(
          135deg,
          var(--negotiation-primary),
          var(--negotiation-secondary)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
      }

      .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--negotiation-text-primary);
        margin: 0;
      }

      .page-description {
        color: var(--negotiation-text-secondary);
        font-size: 1.125rem;
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .analysis-container {
        display: grid;
        grid-template-columns: 1fr 600px;
        gap: 2rem;
        margin-bottom: 2rem;
      }

      /* ==========================================================================
         UNIFIED ANALYSIS PANEL WITH GLASS MORPHISM
         ========================================================================== */
      .unified-analysis-panel {
        background: var(--negotiation-glass);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: 24px;
        box-shadow: var(--negotiation-shadow-lg);
        overflow: hidden;
        height: fit-content;
        min-height: 600px;
        transition: all 0.3s ease;
        position: relative;
      }

      .unified-analysis-panel::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.01) 0%, transparent 100%);
        pointer-events: none;
      }

      .unified-analysis-panel:hover {
        transform: translateY(-2px);
        box-shadow: var(--negotiation-shadow-lg), 0 8px 25px rgba(0, 0, 0, 0.08);
      }

      .unified-tab-header {
        display: flex;
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(15px);
        position: relative;
        z-index: 2;
      }
      
      .unified-tab-btn {
        flex: 1;
        padding: var(--space-4) var(--space-5);
        background: none;
        border: none;
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--negotiation-text-secondary);
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
        border-radius: 12px 12px 0 0;
      }
      
      .unified-tab-btn:hover:not(.active) {
        background: rgba(124, 58, 237, 0.05);
        color: var(--negotiation-text-primary);
        transform: translateY(-1px);
      }
      
      .unified-tab-btn.active {
        background: rgba(124, 58, 237, 0.1);
        color: var(--negotiation-primary);
        border-bottom: 3px solid var(--negotiation-primary);
        transform: translateY(-1px);
      }

      .unified-tab-btn.active::before {
        content: '';
        position: absolute;
        bottom: -1px;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(135deg, var(--negotiation-primary), var(--negotiation-secondary));
        border-radius: 2px 2px 0 0;
      }

      .unified-tab-content {
        padding: var(--space-6);
        height: 450px;
        overflow-y: auto;
        overflow-x: hidden;
        position: relative;
      }

      .unified-tab-content::-webkit-scrollbar {
        width: 6px;
      }

      .unified-tab-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 3px;
      }

      .unified-tab-content::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 3px;
      }

      .unified-tab-content::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.3);
      }

      .unified-tab-pane {
        display: none;
      }

      .unified-tab-pane.active {
        display: block;
      }

      .panel-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-6);
      }

      .panel-actions h3 {
        margin: 0;
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--negotiation-text-primary);
      }

      .copy-btn {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-2) var(--space-3);
        background: rgba(255, 255, 255, 0.6);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: var(--radius);
        font-size: 0.875rem;
        color: var(--negotiation-text-secondary);
        cursor: pointer;
        transition: all 0.2s;
      }

      .copy-btn:hover {
        background: rgba(255, 255, 255, 0.8);
        color: var(--negotiation-text-primary);
      }

      /* ==========================================================================
         MISSING UTILITY CLASSES
         ========================================================================== */
      .flex { display: flex; }
      .items-center { align-items: center; }
      .gap-3 { gap: 0.75rem; }
      .gap-4 { gap: 1rem; }
      .relative { position: relative; }
      .group:hover .group-hover\\:scale-105 { transform: scale(1.05); }
      .h-9 { height: 2.25rem; }
      .w-auto { width: auto; }
      .font-semibold { font-weight: 600; }
      .text-lg { font-size: 1.125rem; }
      .tracking-tight { letter-spacing: -0.025em; }
      .transition-transform { transition: transform 0.3s ease; }

      .analysis-info {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 0.25rem;
      }

      .analysis-badge {
        background: linear-gradient(135deg, var(--negotiation-primary), var(--negotiation-secondary));
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .user-menu-btn {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem 1rem;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(0, 0, 0, 0.05);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .user-menu-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-1px);
      }

      .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--negotiation-primary), var(--negotiation-secondary));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.875rem;
      }

      /* ==========================================================================
         PAGE HEADER
         ========================================================================== */
      .page-header {
        background: white;
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        padding: var(--space-4) var(--space-8);
      }
      
      .header-content h1 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--negotiation-text-primary);
        margin-bottom: var(--space-2);
      }

      /* ==========================================================================
         MAIN LAYOUT
         ========================================================================== */
      .main-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--space-8);
      }
      
      /* Score Section at Top with Glass Morphism */
      .score-section {
        background: var(--negotiation-glass);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: 24px;
        box-shadow: var(--negotiation-shadow-lg);
        padding: var(--space-6) var(--space-8);
        margin-bottom: var(--space-6);
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .score-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.02) 0%, transparent 100%);
        pointer-events: none;
      }
      
      .score-header {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--negotiation-text-secondary);
        margin-bottom: var(--space-4);
        position: relative;
        z-index: 2;
      }
      
      .score-display {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-6);
      }
      
      .score-circle {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--negotiation-primary) 0%, var(--negotiation-secondary) 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.25rem;
        font-weight: 800;
        box-shadow: 0 25px 50px -12px rgba(124, 58, 237, 0.4), 0 15px 25px -8px rgba(124, 58, 237, 0.25);
        flex-shrink: 0;
        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        border: 4px solid rgba(255, 255, 255, 0.3);
        position: relative;
        z-index: 2;
      }

      .score-circle::before {
        content: '';
        position: absolute;
        top: -4px;
        left: -4px;
        right: -4px;
        bottom: -4px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.2) 0%, rgba(74, 144, 226, 0.1) 100%);
        z-index: -1;
        transition: all 0.4s ease;
      }
      
      .score-circle:hover {
        transform: translateY(-4px) scale(1.05);
        box-shadow: 0 35px 70px -12px rgba(124, 58, 237, 0.5), 0 20px 35px -8px rgba(124, 58, 237, 0.35);
      }

      .score-circle:hover::before {
        transform: scale(1.1);
        opacity: 0.8;
      }
      
      .score-details {
        text-align: left;
        position: relative;
        z-index: 2;
      }
      
      .score-label {
        font-size: 1rem;
        color: var(--negotiation-text-secondary);
        margin-bottom: var(--space-2);
        font-weight: 600;
      }
      
      .score-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--negotiation-text-primary);
        margin-bottom: var(--space-3);
        line-height: 1;
      }
      
      .score-description {
        font-size: 1rem;
        color: var(--negotiation-text-secondary);
        font-weight: 500;
        padding: var(--space-2) var(--space-4);
        background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        border-radius: 8px;
        border: 1px solid #e2e8f0;
      }
      
      /* Analysis Panels Layout */
      .analysis-panels {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-6);
        height: calc(100vh - 320px);
      }

      /* ==========================================================================
         TRANSCRIPT PANEL WITH GLASS MORPHISM
         ========================================================================== */
      .transcript-panel {
        background: var(--negotiation-glass);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: 24px;
        box-shadow: var(--negotiation-shadow-lg);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: all 0.3s ease;
        position: relative;
      }

      .transcript-panel::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.01) 0%, transparent 100%);
        pointer-events: none;
      }

      .transcript-panel:hover {
        transform: translateY(-2px);
        box-shadow: var(--negotiation-shadow-lg), 0 8px 25px rgba(0, 0, 0, 0.08);
      }

      .transcript-header {
        padding: var(--space-5) var(--space-6);
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(15px);
        position: relative;
        z-index: 2;
        display: flex;
        align-items: center;
        gap: var(--space-3);
      }

      .transcript-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--negotiation-text-primary);
        margin: 0;
      }

      .transcript-content {
        flex: 1;
        padding: var(--space-6);
        overflow-y: auto;
        position: relative;
        z-index: 2;
      }

      .transcript-text {
        line-height: 1.8;
        color: var(--negotiation-text-secondary);
        background: var(--negotiation-light-bg);
        padding: var(--space-6);
        border-radius: var(--radius);
        border-left: 4px solid var(--negotiation-primary);
        font-size: 0.95rem;
      }

      /* ==========================================================================
         LOADING STATES
         ========================================================================== */
      .loading-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: var(--space-8);
        color: var(--negotiation-text-muted);
      }
      
      .spinner {
        width: 24px;
        height: 24px;
        border: 2px solid rgba(124, 58, 237, 0.2);
        border-top: 2px solid var(--negotiation-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: var(--space-3);
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* ==========================================================================
         INSIGHT CARDS
         ========================================================================== */
      .insight-card-modern {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: 16px;
        margin-bottom: var(--space-5);
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      }

      .insight-card-modern:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }

      .insight-header-modern {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-5);
        background: rgba(255, 255, 255, 0.5);
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      }

      .insight-icon-modern {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, var(--negotiation-primary), var(--negotiation-secondary));
        color: white;
        flex-shrink: 0;
        box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
      }

      .insight-icon-modern.excellent {
        background: linear-gradient(135deg, #10b981, #059669);
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
      }

      .insight-icon-modern.good {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
      }

      .insight-icon-modern.needs-improvement {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
      }

      .insight-title-modern {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--negotiation-text-primary);
        margin: 0;
      }

      .insight-content-modern {
        padding: var(--space-5);
        line-height: 1.7;
        color: var(--negotiation-text-secondary);
      }

      /* ==========================================================================
         METRIC CARDS
         ========================================================================== */
      .metrics-grid {
        display: grid;
        gap: var(--space-4);
      }

      .metric-card {
        background: var(--negotiation-light-bg);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: var(--radius);
        padding: var(--space-4);
        border-left: 4px solid var(--negotiation-primary);
        transition: all 0.2s ease;
      }

      .metric-card:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow);
      }

      .metric-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-3);
      }

      .metric-name {
        font-weight: 600;
        color: var(--negotiation-text-primary);
        font-size: 0.9rem;
      }

      .metric-score {
        font-weight: 600;
        font-size: 0.875rem;
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius-sm);
        background: white;
      }

      .metric-details {
        margin: var(--space-2) 0;
        font-size: 0.8rem;
        color: var(--negotiation-text-secondary);
      }

      .metric-bar {
        height: 6px;
        background: rgba(0, 0, 0, 0.1);
        border-radius: 3px;
        overflow: hidden;
        margin-top: var(--space-2);
      }

      .metric-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      /* ==========================================================================
         QUALITATIVE CATEGORIES
         ========================================================================== */
      .categories-grid {
        display: grid;
        gap: var(--space-4);
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }

      .category-card {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 0, 0, 0.06);
        border-radius: 12px;
        padding: var(--space-5);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .category-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(135deg, var(--negotiation-primary), var(--negotiation-secondary));
      }

      .category-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        background: rgba(255, 255, 255, 0.95);
      }

      .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-3);
      }

      .category-name {
        font-weight: 600;
        color: var(--negotiation-text-primary);
        font-size: 0.95rem;
      }

      .category-score {
        font-weight: 700;
        font-size: 1rem;
        padding: var(--space-2) var(--space-3);
        border-radius: 8px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
        border: 1px solid rgba(0, 0, 0, 0.08);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        position: relative;
        overflow: hidden;
      }

      .category-score::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
      }

      .category-factors {
        margin: var(--space-3) 0;
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-2);
      }

      .factor-tag {
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.08), rgba(74, 144, 226, 0.06));
        color: var(--negotiation-primary);
        padding: 0.375rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        border: 1px solid rgba(124, 58, 237, 0.15);
        transition: all 0.2s ease;
        text-transform: capitalize;
        letter-spacing: 0.025em;
      }

      .factor-tag:hover {
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.12), rgba(74, 144, 226, 0.1));
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(124, 58, 237, 0.2);
      }

      .category-bar {
        height: 8px;
        background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
        border-radius: 12px;
        overflow: hidden;
        margin-top: var(--space-3);
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      .category-bar::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
        animation: barShimmer 3s ease-in-out infinite;
      }

      @keyframes barShimmer {
        0%, 100% { transform: translateX(-100%); }
        50% { transform: translateX(100%); }
      }

      .category-fill {
        height: 100%;
        border-radius: 12px;
        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        background: linear-gradient(135deg, var(--negotiation-primary) 0%, var(--negotiation-secondary) 50%, var(--negotiation-accent) 100%);
        box-shadow: 0 2px 4px rgba(124, 58, 237, 0.3);
        position: relative;
        overflow: hidden;
      }

      .category-fill::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.4) 50%, transparent 100%);
        animation: fillShimmer 2s ease-in-out infinite;
      }

      @keyframes fillShimmer {
        0%, 100% { transform: translateX(-100%); }
        50% { transform: translateX(100%); }
      }

      /* ==========================================================================
         NEXT STEPS SECTION
         ========================================================================== */
      .next-steps-section {
        grid-column: 1 / -1;
        margin-top: var(--space-8);
      }

      .next-steps {
        border-left-color: var(--negotiation-success) !important;
      }

      .next-steps .insight-icon-modern {
        background: var(--negotiation-success);
      }

      /* ==========================================================================
         RESPONSIVE DESIGN
         ========================================================================== */
      @media (max-width: 1024px) {
        .analysis-container {
          grid-template-columns: 1fr;
          gap: var(--space-6);
        }
        
        .transcript-panel,
        .unified-analysis-panel {
          height: auto;
          min-height: 400px;
        }
        
        .top-nav {
          padding: var(--space-4) var(--space-5);
        }
        
        .logo-text {
          font-size: 1.25rem;
        }
      }

      @media (max-width: 768px) {
        .analysis-container {
          padding: var(--space-4);
        }
        
        .unified-tab-btn {
          font-size: 0.7rem;
          padding: var(--space-3) var(--space-4);
        }
        
        .unified-tab-btn span {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <!-- Top Navigation -->
    <nav class="top-nav fade-in delay-100">
      <div class="logo-section">
        <a href="index.html" class="flex items-center gap-3 group">
          <img src="images/tree-logo.svg" alt="Tree Logo" class="h-9 w-auto group-hover:scale-105 transition-transform">
          <span class="font-semibold text-lg tracking-tight nav-brand-text">
              <span class="nav-orange">articul</span><span class="nav-blue">ai</span><span class="nav-orange">tion</span><span class="nav-orange">.com</span>
          </span>
        </a>
        <div class="nav-links">
          <a href="dashboard.html" class="nav-link">Home</a>
          <a href="professional-communication.html" class="nav-link">Professional Communication</a>
          <a href="personal-communication.html" class="nav-link">Personal Communication</a>
          <a href="improvement-hub.html" class="nav-link">Improvement Hub</a>
          <a href="pricing.html" class="nav-link">Pricing</a>
        </div>
      </div>

      <div class="flex items-center gap-4">
        <!-- Analysis Results Info -->
        <div class="analysis-info">
          <span class="analysis-badge" id="analysisTypeBadge">Negotiation Analysis</span>
        </div>
        
        <!-- User Menu -->
        <div class="relative">
          <button class="user-menu-btn" id="userMenuBtn">
            <div class="user-avatar">
              <span id="userInitial">U</span>
            </div>
            <span id="headerUsername">User</span>
            <i data-lucide="chevron-down"></i>
          </button>
        </div>
      </div>
    </nav>

    <!-- Page Header -->
    <header class="page-header slide-up delay-200">
      <div class="header-content">
        <h1 id="resultsTitle">Negotiation Analysis Results</h1>
      </div>
    </header>

    <main class="main-container">
      <!-- Score Section at Top -->
      <div class="score-section scale-in delay-300">
        <div class="score-header">Overall Negotiation Effectiveness Score</div>
        <div class="score-display">
          <div class="score-circle" id="scoreCircle">--</div>
          <div class="score-details">
            <div class="score-label">Negotiation Mastery</div>
            <div class="score-value" id="scoreText">Analyzing...</div>
            <div class="score-description" id="scoreDescription">
              Building your personalized negotiation development plan...
            </div>
          </div>
        </div>
      </div>

      <!-- Analysis Panels Layout -->
      <div class="analysis-panels">
        <!-- Left Panel: Transcript -->
        <div class="transcript-panel slide-up delay-400">
        <div class="transcript-header">
          <i data-lucide="file-text" style="color: var(--negotiation-primary);"></i>
          <h2 class="transcript-title">Your Negotiation</h2>
        </div>
        <div class="transcript-content">
          <div id="transcriptContent">
            <div class="loading-state">
              <div class="spinner"></div>
              <p>Transcribing your negotiation...</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Right Panel: Unified Analysis with 5 Tabs -->
      <div class="unified-analysis-panel slide-up delay-500">
        <!-- Tab Navigation -->
        <div class="unified-tab-header">
          <button class="unified-tab-btn active" data-tab="insights">
            <i data-lucide="lightbulb"></i>
            <span>Insights</span>
          </button>
          <button class="unified-tab-btn" data-tab="quantitative">
            <i data-lucide="bar-chart-2"></i>
            <span>Quantitative</span>
          </button>
          <button class="unified-tab-btn" data-tab="qualitative">
            <i data-lucide="pie-chart"></i>
            <span>Qualitative</span>
          </button>
          <button class="unified-tab-btn" data-tab="communication">
            <i data-lucide="message-circle"></i>
            <span>Communication</span>
          </button>
          <button class="unified-tab-btn" data-tab="feedback">
            <i data-lucide="clipboard-check"></i>
            <span>Feedback</span>
          </button>
        </div>
        
        <!-- Tab Content -->
        <div class="unified-tab-content">
          <!-- Insights Tab -->
          <div class="unified-tab-pane active" id="insights-pane">
            <div class="panel-actions">
              <h3>Strategic Insights</h3>
              <button class="copy-btn" onclick="copyAnalysis()">
                <i data-lucide="copy"></i>
                Copy Insights
              </button>
            </div>
            <div id="detailedAnalysisContent">
              <div class="loading-state">
                <div class="spinner"></div>
                <p>Analyzing your negotiation patterns...</p>
              </div>
            </div>
          </div>
          
          <!-- Quantitative Tab -->
          <div class="unified-tab-pane" id="quantitative-pane">
            <div class="panel-actions">
              <h3>Quantitative Metrics</h3>
              <button class="copy-btn" onclick="copyQuantitative()">
                <i data-lucide="copy"></i>
                Copy Metrics
              </button>
            </div>
            <div id="quantitativeContent">
              <div class="loading-state">
                <div class="spinner"></div>
                <p>Measuring negotiation strategies...</p>
              </div>
            </div>
          </div>
          
          <!-- Qualitative Tab -->
          <div class="unified-tab-pane" id="qualitative-pane">
            <div class="panel-actions">
              <h3>Qualitative Assessment</h3>
              <button class="copy-btn" onclick="copyQualitative()">
                <i data-lucide="copy"></i>
                Copy Assessment
              </button>
            </div>
            <div id="qualitativeContent">
              <div class="loading-state">
                <div class="spinner"></div>
                <p>Evaluating negotiation skills...</p>
              </div>
            </div>
          </div>

          <!-- Communication Insights Tab -->
          <div class="unified-tab-pane" id="communication-pane">
            <div class="panel-actions">
              <h3>Communication Insights</h3>
              <button class="copy-btn" onclick="copyCommunication()">
                <i data-lucide="copy"></i>
                Copy Insights
              </button>
            </div>
            <div id="communicationContent">
              <div class="loading-state">
                <div class="spinner"></div>
                <p>Analyzing communication effectiveness...</p>
              </div>
            </div>
          </div>

          <!-- Copy Feedback Tab -->
          <div class="unified-tab-pane" id="feedback-pane">
            <div class="panel-actions">
              <h3>Actionable Feedback</h3>
              <button class="copy-btn" onclick="copyFeedback()">
                <i data-lucide="copy"></i>
                Copy Feedback
              </button>
            </div>
            <div id="feedbackContent">
              <div class="loading-state">
                <div class="spinner"></div>
                <p>Generating personalized feedback...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Enhanced Next Steps Section -->
      <div class="next-steps-section">
        <div class="insight-card-modern next-steps" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9)); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
          <div class="insight-header-modern">
            <div class="insight-icon-modern" style="background: linear-gradient(135deg, var(--negotiation-primary), var(--negotiation-secondary)); animation: pulse 2s infinite;">
              <i data-lucide="target"></i>
            </div>
            <h3 class="insight-title-modern" style="font-size: 1.5rem; color: var(--negotiation-text-primary); font-weight: 700;">Your Next Steps</h3>
          </div>
          <div class="insight-content-modern">
            <!-- Hero Message -->
            <div style="margin-bottom: 3rem; text-align: center; padding: 2.5rem 2rem; background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9)); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);">
              <div style="max-width: 600px; margin: 0 auto;">
                <h4 style="font-size: 2.25rem; font-weight: 800; background: linear-gradient(135deg, var(--negotiation-primary), var(--negotiation-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0 0 1rem 0; line-height: 1.2;">
                  Transform Your Communication
                </h4>
                <p style="color: var(--negotiation-text-secondary); line-height: 1.8; margin: 0; font-size: 1.125rem; font-weight: 400;">
                  You've unlocked professional insights that transform how you communicate. Choose your growth path and turn these discoveries into <strong style="color: var(--negotiation-primary);">exponential progress</strong>.
                </p>
              </div>
            </div>
            
            
            <!-- Premium Pricing Section -->
            <div style="background: linear-gradient(135deg, rgba(248, 250, 252, 0.95), rgba(241, 245, 249, 0.98)); padding: 2rem; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.8); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.06); backdrop-filter: blur(10px); margin-bottom: 2rem; position: relative; overflow: hidden;">
              
              <!-- Collapsible Header -->
              <div style="position: relative; z-index: 1; cursor: pointer;" onclick="togglePricingSection()">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                  <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(255, 255, 255, 0.8); padding: 0.5rem 1rem; border-radius: 50px; border: 1px solid rgba(0, 0, 0, 0.1);">
                      <i data-lucide="rocket" style="width: 16px; height: 16px; color: var(--negotiation-primary);"></i>
                      <span style="font-size: 0.875rem; font-weight: 600; color: var(--negotiation-primary);">Choose Your Growth Path</span>
                    </div>
                    <div>
                      <h4 style="font-size: 1.5rem; font-weight: 800; color: var(--negotiation-text-primary); margin: 0; line-height: 1.2;">Plans Built for Every Stage</h4>
                      <p style="font-size: 0.875rem; color: var(--negotiation-text-secondary); margin: 0.25rem 0 0 0; font-weight: 400;" id="pricingSubtitle">View Our Improvement Plans</p>
                    </div>
                  </div>
                  <button style="background: rgba(255, 255, 255, 0.8); border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease;" id="pricingToggleBtn" onmouseover="this.style.background='rgba(255, 255, 255, 1)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.1)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.8)'; this.style.boxShadow='none'">
                    <i data-lucide="chevron-down" style="width: 20px; height: 20px; transition: transform 0.3s ease;" id="pricingToggleIcon"></i>
                  </button>
                </div>
              </div>
              
              <!-- Collapsible Content -->
              <div id="pricingContent" style="display: none; opacity: 0; transition: all 0.4s ease; margin-top: 2rem;">
                <p style="font-size: 1rem; color: var(--negotiation-text-secondary); margin: 0.5rem auto 2rem; font-weight: 400; text-align: center; max-width: 500px;">From first insights to complete mastery—grow at your pace with tools designed for real results.</p>
              
              <!-- Premium Pricing Grid -->
              <div style="position: relative; z-index: 1; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; max-width: 1400px; margin: 0 auto;">
                
                <!-- Essential Plan -->
                <div style="background: white; border: 2px solid rgba(0, 0, 0, 0.06); border-radius: 24px; padding: 2.5rem 2rem; text-align: left; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);" onmouseover="this.style.transform='translateY(-12px)'; this.style.boxShadow='0 25px 50px rgba(99, 102, 241, 0.15)'; this.style.borderColor='rgba(99, 102, 241, 0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 20px rgba(0, 0, 0, 0.04)'; this.style.borderColor='rgba(0, 0, 0, 0.06)'">
                  <div style="margin-bottom: 2rem;">
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(99, 102, 241, 0.1); padding: 0.375rem 0.75rem; border-radius: 50px; margin-bottom: 1.5rem;">
                      <i data-lucide="play" style="width: 14px; height: 14px; color: var(--negotiation-primary);"></i>
                      <span style="font-size: 0.75rem; font-weight: 600; color: var(--negotiation-primary); text-transform: uppercase; letter-spacing: 0.5px;">Essential</span>
                    </div>
                    <h5 style="font-size: 1.5rem; font-weight: 800; color: var(--negotiation-text-primary); margin: 0 0 0.5rem 0;">Start Your Growth</h5>
                    <p style="color: var(--negotiation-text-secondary); font-size: 1rem; margin: 0 0 1.5rem 0; line-height: 1.6;">Perfect for building steady confidence in how you express yourself.</p>
                    <div style="margin-bottom: 2rem;">
                      <span style="font-size: 3rem; font-weight: 900; color: var(--negotiation-text-primary); line-height: 1;">$9.99</span>
                      <span style="font-size: 1rem; font-weight: 500; color: var(--negotiation-text-secondary);">/month</span>
                    </div>
                  </div>
                  
                  <div style="margin-bottom: 2rem;">
                    <div style="font-weight: 600; color: var(--negotiation-text-primary); margin-bottom: 1rem; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px;">What's included:</div>
                    <ul style="list-style: none; padding: 0; margin: 0; space-y: 0.75rem;">
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="check" style="width: 12px; height: 12px; color: #10b981;"></i>
                        </div>
                        <span>10 detailed audio analyses per month</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="check" style="width: 12px; height: 12px; color: #10b981;"></i>
                        </div>
                        <span>Monthly improvement catalog with drills</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="check" style="width: 12px; height: 12px; color: #10b981;"></i>
                        </div>
                        <span>Email support</span>
                      </li>
                    </ul>
                  </div>
                  
                  <button onclick="window.location.href='pricing.html'" style="width: 100%; background: var(--negotiation-primary); color: white; border: none; padding: 1rem 1.5rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);" onmouseover="this.style.background='#5145db'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(99, 102, 241, 0.35)'" onmouseout="this.style.background='var(--negotiation-primary)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(99, 102, 241, 0.25)'">Get Started</button>
                </div>
                
                <!-- Max Growth Plan -->
                <div style="background: linear-gradient(135deg, white, #fafbff); border: 3px solid var(--negotiation-primary); border-radius: 24px; padding: 2.5rem 2rem; text-align: left; position: relative; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; transform: scale(1.05); box-shadow: 0 20px 40px rgba(99, 102, 241, 0.15);" onmouseover="this.style.transform='translateY(-12px) scale(1.08)'; this.style.boxShadow='0 30px 60px rgba(99, 102, 241, 0.25)'" onmouseout="this.style.transform='translateY(0) scale(1.05)'; this.style.boxShadow='0 20px 40px rgba(99, 102, 241, 0.15)'">
                  <!-- Popular Badge -->
                  <div style="position: absolute; top: -1px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, var(--negotiation-primary), var(--negotiation-secondary)); color: white; padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.625rem; font-weight: 600; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3); text-transform: uppercase; letter-spacing: 0.5px;">
                    <i data-lucide="star" style="width: 10px; height: 10px; margin-right: 0.2rem;"></i>Popular
                  </div>
                  
                  <div style="margin-bottom: 2rem; margin-top: 1rem;">
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05)); padding: 0.375rem 0.75rem; border-radius: 50px; margin-bottom: 1.5rem;">
                      <i data-lucide="zap" style="width: 14px; height: 14px; color: var(--negotiation-primary);"></i>
                      <span style="font-size: 0.75rem; font-weight: 600; color: var(--negotiation-primary); text-transform: uppercase; letter-spacing: 0.5px;">Max Growth</span>
                    </div>
                    <h5 style="font-size: 1.5rem; font-weight: 800; color: var(--negotiation-text-primary); margin: 0 0 0.5rem 0;">Complete Transformation</h5>
                    <p style="color: var(--negotiation-text-secondary); font-size: 1rem; margin: 0 0 1.5rem 0; line-height: 1.6;">For serious communicators ready to unlock their full potential with unlimited practice and expert guidance.</p>
                    <div style="margin-bottom: 2rem;">
                      <span style="font-size: 3rem; font-weight: 900; color: var(--negotiation-text-primary); line-height: 1;">$15.99</span>
                      <span style="font-size: 1rem; font-weight: 500; color: var(--negotiation-text-secondary);">/month</span>
                    </div>
                  </div>
                  
                  <div style="margin-bottom: 2rem;">
                    <div style="font-weight: 600; color: var(--negotiation-text-primary); margin-bottom: 1rem; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px;">Everything in Essential, plus:</div>
                    <ul style="list-style: none; padding: 0; margin: 0; space-y: 0.75rem;">
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="infinity" style="width: 12px; height: 12px; color: var(--negotiation-primary);"></i>
                        </div>
                        <span><strong>Unlimited</strong> audio analysis</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="users" style="width: 12px; height: 12px; color: var(--negotiation-primary);"></i>
                        </div>
                        <span>Weekly expert review sessions</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="sparkles" style="width: 12px; height: 12px; color: var(--negotiation-primary);"></i>
                        </div>
                        <span>Full access to Improvement Hub</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="clock" style="width: 12px; height: 12px; color: var(--negotiation-primary);"></i>
                        </div>
                        <span>Early access to new tools</span>
                      </li>
                    </ul>
                  </div>
                  
                  <button onclick="window.location.href='pricing.html'" style="width: 100%; background: linear-gradient(135deg, var(--negotiation-primary), var(--negotiation-secondary)); color: white; border: none; padding: 1rem 1.5rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 12px 30px rgba(99, 102, 241, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 20px rgba(99, 102, 241, 0.4)'">Start Free Trial</button>
                </div>
                
                <!-- Enterprise Plan -->
                <div style="background: white; border: 2px solid rgba(107, 114, 128, 0.15); border-radius: 24px; padding: 2.5rem 2rem; text-align: left; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);" onmouseover="this.style.transform='translateY(-12px)'; this.style.boxShadow='0 25px 50px rgba(107, 114, 128, 0.15)'; this.style.borderColor='rgba(107, 114, 128, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 20px rgba(0, 0, 0, 0.04)'; this.style.borderColor='rgba(107, 114, 128, 0.15)'">
                  <div style="margin-bottom: 2rem;">
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(107, 114, 128, 0.1); padding: 0.375rem 0.75rem; border-radius: 50px; margin-bottom: 1.5rem;">
                      <i data-lucide="building" style="width: 14px; height: 14px; color: var(--negotiation-text-primary);"></i>
                      <span style="font-size: 0.75rem; font-weight: 600; color: var(--negotiation-text-primary); text-transform: uppercase; letter-spacing: 0.5px;">Enterprise</span>
                    </div>
                    <h5 style="font-size: 1.5rem; font-weight: 800; color: var(--negotiation-text-primary); margin: 0 0 0.5rem 0;">Scale Your Team</h5>
                    <p style="color: var(--negotiation-text-secondary); font-size: 1rem; margin: 0 0 1.5rem 0; line-height: 1.6;">Custom solutions for teams, coaches, and organizations building communication excellence.</p>
                    <div style="margin-bottom: 2rem;">
                      <span style="font-size: 3rem; font-weight: 900; color: var(--negotiation-text-primary); line-height: 1;">Custom</span>
                      <span style="font-size: 1rem; font-weight: 500; color: var(--negotiation-text-secondary);"> pricing</span>
                    </div>
                  </div>
                  
                  <div style="margin-bottom: 2rem;">
                    <div style="font-weight: 600; color: var(--negotiation-text-primary); margin-bottom: 1rem; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px;">Enterprise features:</div>
                    <ul style="list-style: none; padding: 0; margin: 0; space-y: 0.75rem;">
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(107, 114, 128, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="chart-line" style="width: 12px; height: 12px; color: var(--negotiation-text-primary);"></i>
                        </div>
                        <span>Custom team dashboards & analytics</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(107, 114, 128, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="users-2" style="width: 12px; height: 12px; color: var(--negotiation-text-primary);"></i>
                        </div>
                        <span>Group metrics & shared insights</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(107, 114, 128, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="headphones" style="width: 12px; height: 12px; color: var(--negotiation-text-primary);"></i>
                        </div>
                        <span>Dedicated support & onboarding</span>
                      </li>
                    </ul>
                  </div>
                  
                  <button onclick="window.location.href='pricing.html'" style="width: 100%; background: var(--negotiation-text-primary); color: white; border: none; padding: 1rem 1.5rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 4px 12px rgba(107, 114, 128, 0.25);" onmouseover="this.style.background='#1f2937'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(107, 114, 128, 0.35)'" onmouseout="this.style.background='var(--negotiation-text-primary)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(107, 114, 128, 0.25)'">Contact Sales</button>
                </div>
                
                <!-- One-Time Plan -->
                <div style="background: white; border: 2px solid rgba(139, 92, 246, 0.15); border-radius: 24px; padding: 2.5rem 2rem; text-align: left; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);" onmouseover="this.style.transform='translateY(-12px)'; this.style.boxShadow='0 25px 50px rgba(139, 92, 246, 0.15)'; this.style.borderColor='rgba(139, 92, 246, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 20px rgba(0, 0, 0, 0.04)'; this.style.borderColor='rgba(139, 92, 246, 0.15)'">
                  <div style="margin-bottom: 2rem;">
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(139, 92, 246, 0.1); padding: 0.375rem 0.75rem; border-radius: 50px; margin-bottom: 1.5rem;">
                      <i data-lucide="file-text" style="width: 14px; height: 14px; color: var(--negotiation-secondary);"></i>
                      <span style="font-size: 0.75rem; font-weight: 600; color: var(--negotiation-secondary); text-transform: uppercase; letter-spacing: 0.5px;">One-Time</span>
                    </div>
                    <h5 style="font-size: 1.5rem; font-weight: 800; color: var(--negotiation-text-primary); margin: 0 0 0.5rem 0;">Personal Blueprint</h5>
                    <p style="color: var(--negotiation-text-secondary); font-size: 1rem; margin: 0 0 1.5rem 0; line-height: 1.6;">A comprehensive communication analysis and personalized improvement plan delivered as a PDF.</p>
                    <div style="margin-bottom: 2rem;">
                      <span style="font-size: 3rem; font-weight: 900; color: var(--negotiation-text-primary); line-height: 1;">$30</span>
                      <span style="font-size: 1rem; font-weight: 500; color: var(--negotiation-text-secondary);"> one-time</span>
                    </div>
                  </div>
                  
                  <div style="margin-bottom: 2rem;">
                    <div style="font-weight: 600; color: var(--negotiation-text-primary); margin-bottom: 1rem; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px;">What you get:</div>
                    <ul style="list-style: none; padding: 0; margin: 0; space-y: 0.75rem;">
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(139, 92, 246, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="search" style="width: 12px; height: 12px; color: var(--negotiation-secondary);"></i>
                        </div>
                        <span>Deep analysis of vocal patterns & delivery</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(139, 92, 246, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="target" style="width: 12px; height: 12px; color: var(--negotiation-secondary);"></i>
                        </div>
                        <span>Targeted breakdown of specific issues</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--negotiation-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(139, 92, 246, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="download" style="width: 12px; height: 12px; color: var(--negotiation-secondary);"></i>
                        </div>
                        <span>Lifetime PDF access—yours forever</span>
                      </li>
                    </ul>
                  </div>
                  
                  <button onclick="window.location.href='pricing.html'" style="width: 100%; background: var(--negotiation-secondary); color: white; border: none; padding: 1rem 1.5rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.25);" onmouseover="this.style.background='#7c3aed'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(139, 92, 246, 0.35)'" onmouseout="this.style.background='var(--negotiation-secondary)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(139, 92, 246, 0.25)'">Get My Report</button>
                </div>
                
              </div>
              
              </div>
            </div>
            
            <!-- Enhanced Action Section -->
            <div style="margin-top: 3rem; text-align: center; padding: 3rem 2rem; background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(248, 250, 252, 0.9)); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);">
              <div style="max-width: 600px; margin: 0 auto 2rem;">
                <h4 style="font-size: 1.5rem; font-weight: 700; color: var(--negotiation-text-primary); margin: 0 0 0.75rem 0;">Ready to Continue Your Growth?</h4>
                <p style="color: var(--negotiation-text-secondary); line-height: 1.6; margin: 0; font-size: 1rem;">Keep building on these insights or explore more tools to accelerate your communication mastery.</p>
              </div>
              
              <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; max-width: 500px; margin: 0 auto;">
                <button onclick="window.location.href='negotiation-analysis.html'" 
                  style="background: linear-gradient(135deg, var(--negotiation-primary), var(--negotiation-secondary)); color: white; border: none; padding: 1rem 2rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); flex: 1; min-width: 200px;"
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(99, 102, 241, 0.4)'"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(99, 102, 241, 0.3)'">
                  <i data-lucide="mic" style="width: 16px; height: 16px; margin-right: 0.5rem; vertical-align: middle;"></i>
                  Practice Again
                </button>
                <button onclick="window.location.href='improvement-hub.html'" 
                  style="background: white; color: var(--negotiation-primary); border: 2px solid var(--negotiation-primary); padding: 1rem 2rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; flex: 1; min-width: 200px;"
                  onmouseover="this.style.background='var(--negotiation-primary)'; this.style.color='white'; this.style.transform='translateY(-2px)'"
                  onmouseout="this.style.background='white'; this.style.color='var(--negotiation-primary)'; this.style.transform='translateY(0)'">
                  <i data-lucide="sparkles" style="width: 16px; height: 16px; margin-right: 0.5rem; vertical-align: middle;"></i>
                  Explore Improvement Hub
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // CRITICAL: Set up Gemini API key for transcription
      window.GEMINI_API_KEY = "AIzaSyBGvwarFw2FbxgxOMnFchyji6G-zYkrgV8";
      console.log("🔑 Gemini API key configured for negotiation analysis");

      // Toggle pricing section
      function togglePricingSection() {
        const content = document.getElementById('pricingContent');
        const icon = document.getElementById('pricingToggleIcon');
        const subtitle = document.getElementById('pricingSubtitle');
        const button = document.getElementById('pricingToggleBtn');
        
        if (content.style.display === 'none' || content.style.display === '') {
          // Show content
          content.style.display = 'block';
          setTimeout(() => {
            content.style.opacity = '1';
            content.style.transform = 'translateY(0)';
          }, 10);
          icon.style.transform = 'rotate(180deg)';
          subtitle.textContent = 'Click to collapse pricing options';
          button.style.background = 'var(--negotiation-primary)';
          button.style.borderColor = 'var(--negotiation-primary)';
          icon.style.color = 'white';
        } else {
          // Hide content
          content.style.opacity = '0';
          content.style.transform = 'translateY(-20px)';
          setTimeout(() => {
            content.style.display = 'none';
          }, 400);
          icon.style.transform = 'rotate(0deg)';
          subtitle.textContent = 'View Our Improvement Plans';
          button.style.background = 'rgba(255, 255, 255, 0.8)';
          button.style.borderColor = 'rgba(0, 0, 0, 0.1)';
          icon.style.color = 'var(--negotiation-text-primary)';
        }
        
        // Re-initialize lucide icons
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
        }
      }

      // Negotiation-Specific Metrics Configuration
      const negotiationMetrics = {
        quantitative: {
          'Value Alignment Phrasing': { 
            weight: 0.20, 
            optimal: { min: 1, max: 5 },
            description: 'Phrases like "What matters most to you is..." or "You\'re looking for X, right?"',
            ideal: 'At least 1 in short clips, 2+ per minute in longer ones'
          },
          'Flexibility Indicator': { 
            weight: 0.18, 
            optimal: { min: 1, max: 4 },
            description: 'Language such as "Would you be open to..." or "Is there another way we can..."',
            ideal: '≥ 1 adaptable phrase per offer or shift'
          },
          'Assertive Ask Ratio': { 
            weight: 0.16, 
            optimal: { min: 0.75, max: 1.0 },
            description: 'Balance of strong, clear asks ("We\'d need...", "Our position is...") to hedging',
            ideal: 'At least 1 clear ask per major turn, with assertiveness detected ≥ 0.75 on a 0–1 scale'
          },
          'Empathy Acknowledgment Density': { 
            weight: 0.15, 
            optimal: { min: 1, max: 5 },
            description: 'Phrases like "That\'s a fair concern," or "I understand where you\'re coming from."',
            ideal: '1 in short clips; ≥ 3 in longer exchanges'
          },
          'Concession Framing Presence': { 
            weight: 0.14, 
            optimal: { min: 1, max: 3 },
            description: 'Statements such as "We might be able to..." or "If we did that, we\'d need..."',
            ideal: 'At least 1 clear concession phrase per negotiation segment'
          },
          'Tone Control Score': { 
            weight: 0.12, 
            optimal: { min: 0.75, max: 1.0 },
            description: 'AI-detected composure during tense or strategic moments',
            ideal: 'Confidence score ≥ 0.75'
          },
          'Trade Summary Clarity': { 
            weight: 0.05, 
            optimal: { min: 1, max: 1 },
            description: 'Clear "If X, then Y" wrap-up or term summary at the end of proposal',
            ideal: 'Present in final 15% of the response'
          }
        },
        qualitative: {
          'Tone Under Pressure': { 
            weight: 0.25, 
            factors: ['composure maintenance', 'emotional regulation', 'stress management', 'calm demeanor'],
            description: 'Maintaining professional composure during challenging moments'
          },
          'Collaborative Framing': { 
            weight: 0.25, 
            factors: ['win-win language', 'partnership mindset', 'mutual benefit focus', 'shared problem solving'],
            description: 'Using language that builds bridges rather than creates barriers'
          },
          'Strategic Empathy': { 
            weight: 0.25, 
            factors: ['understanding perspectives', 'acknowledging concerns', 'emotional intelligence', 'rapport building'],
            description: 'Demonstrating genuine understanding of the other party\'s position'
          },
          'Clarity of Terms & Trade Language': { 
            weight: 0.15, 
            factors: ['precise communication', 'clear proposals', 'structured thinking', 'logical flow'],
            description: 'Articulating proposals and trade-offs with clarity and precision'
          },
          'Respectfulness & Professionalism': { 
            weight: 0.10, 
            factors: ['professional tone', 'courteous language', 'respectful disagreement', 'diplomatic approach'],
            description: 'Maintaining respect and professionalism throughout the negotiation'
          }
        }
      };

      // Unified tab switching functionality
      function initializeUnifiedTabSwitching() {
        const tabButtons = document.querySelectorAll('.unified-tab-btn');
        const tabPanes = document.querySelectorAll('.unified-tab-pane');
        
        tabButtons.forEach(button => {
          button.addEventListener('click', () => {
            const targetTab = button.dataset.tab;
            
            // Update active tab button
            tabButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            // Update active tab pane
            tabPanes.forEach(pane => pane.classList.remove('active'));
            document.getElementById(targetTab + '-pane').classList.add('active');
          });
        });
      }

      // Transcribe audio using Gemini AI
      async function transcribeAudioWithGemini(audioFile) {
        try {
          console.log("🎤 Transcribing negotiation audio with Gemini...");
          
          // Get API key from config
          const apiKey = window.API_CONFIG?.gemini || window.GEMINI_API_KEY;
          if (!apiKey || apiKey === 'YOUR_GEMINI_API_KEY_HERE') {
            throw new Error("Gemini API key not configured");
          }
          
          const arrayBuffer = await audioFile.arrayBuffer();
          const base64Audio = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
          
          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              contents: [{
                parts: [
                  {
                    text: "Please transcribe this negotiation audio file accurately. Return only the transcribed text without any additional commentary."
                  },
                  {
                    inline_data: {
                      mime_type: audioFile.type,
                      data: base64Audio
                    }
                  }
                ]
              }],
              generationConfig: {
                temperature: 0.1,
                maxOutputTokens: 8000,
                topP: 0.8,
                topK: 40
              }
            })
          });

          // Check for HTTP errors
          if (!response.ok) {
            const errorText = await response.text();
            console.error(`❌ Gemini API error: ${response.status} - ${response.statusText}`, errorText);
            
            // Handle specific error cases with better messaging
            if (response.status === 503) {
              console.log("🔄 Gemini service temporarily unavailable, using fallback demo transcript");
              return getDemoNegotiationTranscript();
            } else if (response.status === 429) {
              throw new Error("Rate limit exceeded. Please try again in a few minutes.");
            } else if (response.status === 401 || response.status === 403) {
              throw new Error("API authentication error. Please check your Gemini API configuration.");
            } else if (response.status === 400) {
              throw new Error("Invalid request format. Please check your audio file.");
            } else {
              console.log(`🔄 Gemini API error (${response.status}), using fallback demo transcript`);
              return getDemoNegotiationTranscript();
            }
          }

          const data = await response.json();
          
          if (data.candidates && data.candidates[0] && data.candidates[0].content) {
            const transcript = data.candidates[0].content.parts[0].text;
            console.log("✅ Negotiation transcription successful");
            return transcript;
          } else {
            console.error("❌ Invalid Gemini API response structure:", data);
            throw new Error("No transcription received from Gemini");
          }
        } catch (error) {
          console.error("❌ Transcription error:", error);
          
          // Provide fallback demo transcript for development/testing
          if (error.message.includes("503") || error.message.includes("service unavailable")) {
            console.log("🔄 Providing fallback demo transcript due to service unavailability");
            return getDemoNegotiationTranscript();
          }
          
          throw new Error(`Transcription failed: ${error.message}`);
        }
      }

      // Fallback demo transcript for negotiation scenarios
      function getDemoNegotiationTranscript() {
        return `Thank you for meeting with me today. I know we're here to discuss the contract terms, and I want to make sure we find an approach that works for both of us.

I've reviewed your proposal, and I have to say, while I appreciate the comprehensive service offering, the pricing structure is significantly higher than what we were anticipating. We're looking at about a 25% increase over our current budget allocation.

What matters most to you is delivering quality results, and I completely understand that. You're looking for fair compensation for the value you provide, right? That's absolutely reasonable.

At the same time, I need to be transparent about our constraints. We're working within a fixed budget this fiscal year, and we have other stakeholders who need to see the value proposition clearly.

Would you be open to exploring some alternative approaches? Is there another way we can structure this that might work better for both parties?

I'm thinking we might be able to adjust the timeline or modify some of the deliverables to find a middle ground. If we did that, we'd need to ensure the core objectives are still met, of course.

That's a fair concern you've raised about maintaining quality standards. I understand where you're coming from, and I don't want to compromise the integrity of the work either.

What if we looked at this differently? Instead of a 25% reduction across the board, could we phase the implementation? We might be able to start with the essential components now and add the additional features in the next quarter when our budget refreshes.

If we went that route, we'd need clear milestones and deliverables for each phase. Does that sound like something that could work from your perspective?

I really value our partnership, and I want to find a solution that allows us to move forward together. We've had great results working with your team in the past, and I'd hate to see that relationship end over pricing disagreements.

Let me ask you this: what would be the minimum viable version of this project that would still deliver meaningful results? If we could identify that core offering, perhaps we could build from there.

I think we're making good progress here. To summarize what we've discussed: if we phase the implementation with essential components starting now at 80% of the original budget, then we'd add the enhanced features in Q2 at the remaining 20% plus a 10% adjustment for the additional scope. Does that capture our discussion accurately?`;
      }

      // Analyze negotiation using specific metrics
      async function analyzeNegotiation(transcript) {
        try {
          console.log("🧠 Analyzing negotiation conversation...");
          
          const quantitativeScores = await calculateNegotiationQuantitativeMetrics(transcript, negotiationMetrics.quantitative);
          const qualitativeScores = await calculateNegotiationQualitativeMetrics(transcript, negotiationMetrics.qualitative);
          const overallScore = calculateNegotiationOverallScore(quantitativeScores, qualitativeScores);
          const insights = await generateNegotiationInsights(transcript, quantitativeScores, qualitativeScores);
          const communicationInsights = await generateCommunicationInsights(transcript, quantitativeScores, qualitativeScores);
          const actionableFeedback = await generateActionableFeedback(transcript, quantitativeScores, qualitativeScores);
          
          return {
            transcript: transcript,
            analysisType: "negotiation",
            quantitativeScores: quantitativeScores,
            qualitativeScores: qualitativeScores,
            overallScore: overallScore,
            insights: insights,
            communicationInsights: communicationInsights,
            actionableFeedback: actionableFeedback
          };
        } catch (error) {
          console.error("❌ Negotiation analysis error:", error);
          throw new Error(`Analysis failed: ${error.message}`);
        }
      }

      // Calculate quantitative metrics for negotiation
      async function calculateNegotiationQuantitativeMetrics(transcript, quantitativeConfig) {
        if (!transcript || typeof transcript !== 'string') {
          console.error('Invalid transcript provided to calculateNegotiationQuantitativeMetrics');
          return {};
        }
        
        const words = transcript.split(/\s+/).filter(word => word.length > 0);
        const sentences = transcript.split(/[.!?]+/).filter(s => s.trim().length > 0);
        
        const metrics = {};
        
        // Value Alignment Phrasing
        const valueAlignmentPhrases = [
          /what matters most to you/gi,
          /you're looking for/gi,
          /you want/gi,
          /important to you/gi,
          /your priority/gi,
          /what you need/gi
        ];
        metrics['Value Alignment Phrasing'] = valueAlignmentPhrases.reduce((count, phrase) => {
          return count + (transcript.match(phrase) || []).length;
        }, 0);
        
        // Flexibility Indicator
        const flexibilityPhrases = [
          /would you be open to/gi,
          /is there another way/gi,
          /could we explore/gi,
          /what if we/gi,
          /perhaps we could/gi,
          /might be able to/gi
        ];
        metrics['Flexibility Indicator'] = flexibilityPhrases.reduce((count, phrase) => {
          return count + (transcript.match(phrase) || []).length;
        }, 0);
        
        // Assertive Ask Ratio
        const assertivePhrases = [
          /we need/gi,
          /our position is/gi,
          /we require/gi,
          /i need/gi,
          /we must/gi,
          /it's important that/gi
        ];
        const hedgingPhrases = [
          /maybe/gi,
          /perhaps/gi,
          /i think/gi,
          /sort of/gi,
          /kind of/gi,
          /probably/gi
        ];
        const assertiveCount = assertivePhrases.reduce((count, phrase) => {
          return count + (transcript.match(phrase) || []).length;
        }, 0);
        const hedgingCount = hedgingPhrases.reduce((count, phrase) => {
          return count + (transcript.match(phrase) || []).length;
        }, 0);
        metrics['Assertive Ask Ratio'] = hedgingCount > 0 ? assertiveCount / (assertiveCount + hedgingCount) : (assertiveCount > 0 ? 1 : 0);
        
        // Empathy Acknowledgment Density
        const empathyPhrases = [
          /that's a fair concern/gi,
          /i understand where you're coming from/gi,
          /i see your point/gi,
          /that makes sense/gi,
          /i appreciate/gi,
          /i can see why/gi
        ];
        metrics['Empathy Acknowledgment Density'] = empathyPhrases.reduce((count, phrase) => {
          return count + (transcript.match(phrase) || []).length;
        }, 0);
        
        // Concession Framing Presence
        const concessionPhrases = [
          /we might be able to/gi,
          /if we did that/gi,
          /we could consider/gi,
          /what if we/gi,
          /perhaps we could/gi,
          /one option would be/gi
        ];
        metrics['Concession Framing Presence'] = concessionPhrases.reduce((count, phrase) => {
          return count + (transcript.match(phrase) || []).length;
        }, 0);
        
        // Tone Control Score (simplified assessment)
        const stressIndicators = [
          /um/gi,
          /uh/gi,
          /well/gi,
          /so/gi
        ];
        const stressCount = stressIndicators.reduce((count, phrase) => {
          return count + (transcript.match(phrase) || []).length;
        }, 0);
        metrics['Tone Control Score'] = Math.max(0.3, Math.min(1.0, 1.0 - (stressCount / words.length) * 10));
        
        // Trade Summary Clarity
        const clarityPhrases = [
          /if.*then/gi,
          /to summarize/gi,
          /so what we're saying is/gi,
          /let me recap/gi,
          /the proposal is/gi
        ];
        metrics['Trade Summary Clarity'] = clarityPhrases.reduce((count, phrase) => {
          return count + (transcript.match(phrase) || []).length;
        }, 0);
        
        return metrics;
      }

      // Calculate qualitative metrics using AI analysis
      async function calculateNegotiationQualitativeMetrics(transcript, qualitativeConfig) {
        if (!transcript || typeof transcript !== 'string') {
          console.error('Invalid transcript provided to calculateNegotiationQualitativeMetrics');
          return {};
        }
        
        if (!qualitativeConfig || typeof qualitativeConfig !== 'object') {
          console.error('Invalid qualitativeConfig provided');
          return {};
        }
        
        try {
          const prompt = `You are an expert negotiation consultant analyzing a negotiation transcript. Focus on strategic communication excellence, deal-making effectiveness, collaborative problem-solving mastery, and balanced assertiveness.

Analyze this negotiation transcript for these specific negotiation skills. Rate each factor from 1-10:

Tone Under Pressure: Evaluate composure maintenance, emotional regulation, stress management, calm demeanor during challenging moments, and pressure resilience in high-stakes situations
Collaborative Framing: Evaluate win-win language effectiveness, partnership mindset demonstration, mutual benefit focus, shared problem solving approach, and value creation strategies
Strategic Empathy: Evaluate perspective understanding, concern acknowledgment, emotional intelligence application, rapport building effectiveness, and relationship preservation during conflict
Clarity of Terms & Trade Language: Evaluate precise communication, clear proposal articulation, structured thinking presentation, logical flow maintenance, and deal structure clarity
Respectfulness & Professionalism: Evaluate professional tone consistency, courteous language usage, respectful disagreement handling, diplomatic approach effectiveness, and relationship-preserving assertiveness

Transcript: "${transcript}"

Evaluate against professional negotiation standards and strategic communication excellence benchmarks. Consider deal-making effectiveness, relationship preservation, and collaborative problem-solving mastery.

Provide scores in this exact format:
Tone Under Pressure: [score 1-10]
Collaborative Framing: [score 1-10]
Strategic Empathy: [score 1-10]
Clarity of Terms & Trade Language: [score 1-10]
Respectfulness & Professionalism: [score 1-10]`;

          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${window.GEMINI_API_KEY}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              contents: [{
                parts: [{
                  text: prompt
                }]
              }]
            })
          });

          const data = await response.json();
          
          if (!data.candidates || !data.candidates[0] || !data.candidates[0].content || !data.candidates[0].content.parts || !data.candidates[0].content.parts[0]) {
            console.error('Invalid response structure from Gemini API:', data);
            throw new Error('Invalid API response structure');
          }
          
          const analysisText = data.candidates[0].content.parts[0].text;
          
          const scores = {};
          Object.keys(qualitativeConfig).forEach(metric => {
            const match = analysisText.match(new RegExp(`${metric}:\\s*(\\d+)`, 'i'));
            scores[metric] = match ? parseInt(match[1]) : 6; // Default to 6 for negotiation
          });
          
          return scores;
        } catch (error) {
          console.error("Error calculating qualitative metrics:", error);
          
          // Provide negotiation-specific default scores
          const defaultScores = {
            'Tone Under Pressure': 6,
            'Collaborative Framing': 7,
            'Strategic Empathy': 6,
            'Clarity of Terms & Trade Language': 6,
            'Respectfulness & Professionalism': 7
          };
          
          console.log("🔄 Using default negotiation scores due to API error");
          return defaultScores;
        }
      }

      // Calculate overall negotiation score
      function calculateNegotiationOverallScore(quantitativeScores, qualitativeScores) {
        if (!quantitativeScores || !qualitativeScores) {
          console.error('Invalid scores provided to calculateNegotiationOverallScore');
          return 6; // Default middle-high score for negotiation
        }
        
        const qualitativeWeight = 0.65; // Higher weight on qualitative for negotiation
        const quantitativeWeight = 0.35;
        
        const qualitativeValues = Object.values(qualitativeScores);
        if (qualitativeValues.length === 0) {
          console.error('No qualitative scores available');
          return 6;
        }
        
        const qualitativeAvg = qualitativeValues.reduce((a, b) => a + b, 0) / qualitativeValues.length;
        
        // Calculate quantitative average from actual metrics
        const quantitativeMetrics = Object.entries(quantitativeScores).map(([metric, value]) => {
          const config = negotiationMetrics.quantitative && negotiationMetrics.quantitative[metric];
          if (!config) return 6; // Default score
          
          const { optimal } = config;
          // Score based on how close to optimal range
          if (value >= optimal.min && value <= optimal.max) {
            return 8; // Great score
          } else if (value < optimal.min) {
            return Math.max(3, 8 - ((optimal.min - value) / optimal.min) * 5);
          } else {
            return Math.max(3, 8 - ((value - optimal.max) / optimal.max) * 5);
          }
        });
        
        const quantitativeAvg = quantitativeMetrics.length > 0 ? quantitativeMetrics.reduce((a, b) => a + b, 0) / quantitativeMetrics.length : 6;
        
        const overallScore = (qualitativeAvg * qualitativeWeight + quantitativeAvg * quantitativeWeight);
        return Math.round(overallScore * 10) / 10;
      }

      // Generate negotiation insights
      async function generateNegotiationInsights(transcript, quantitativeScores, qualitativeScores) {
        if (!transcript || typeof transcript !== 'string') {
          console.error('Invalid transcript provided to generateNegotiationInsights');
          return 'Unable to generate insights - invalid transcript data';
        }
        
        try {
          const prompt = `You are an expert negotiation strategist providing detailed analysis of this negotiation transcript. Focus on strategic communication, deal-making mastery, collaborative problem-solving, and balanced assertiveness.

Analyze this negotiation transcript and provide strategic insights in this exact format:

NEGOTIATION STRENGTHS:
• [List 3-4 specific strengths in negotiation approach, strategic positioning, deal-making effectiveness, or collaborative problem-solving]

AREAS FOR IMPROVEMENT:
• [List 3-4 specific areas to improve negotiation effectiveness, strategic positioning, or balanced assertiveness]

STRATEGIC RECOMMENDATIONS:
• [List 3-4 actionable recommendations for enhanced negotiation skills, better deal outcomes, and strategic communication mastery]

Transcript: "${transcript}"

Focus specifically on negotiation excellence: strategic communication effectiveness, balance of assertiveness and collaboration, deal-making and value creation skills, relationship building during conflict, outcome optimization strategies, strategic empathy application, and win-win solution development. Evaluate against professional negotiation standards and strategic communication benchmarks.`;

          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${window.GEMINI_API_KEY}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              contents: [{
                parts: [{
                  text: prompt
                }]
              }]
            })
          });

          const data = await response.json();
          
          if (!data.candidates || !data.candidates[0] || !data.candidates[0].content || !data.candidates[0].content.parts || !data.candidates[0].content.parts[0]) {
            console.error('Invalid response structure from Gemini API:', data);
            throw new Error('Invalid API response structure');
          }
          
          return data.candidates[0].content.parts[0].text;
        } catch (error) {
          console.error("Error generating negotiation insights:", error);
          console.log("🔄 Using default negotiation insights due to API error");
          return `NEGOTIATION STRENGTHS:
• Demonstrated strategic thinking and preparation in negotiation approach
• Maintained professional composure during challenging discussions
• Showed willingness to explore creative solutions and alternatives
• Balanced assertiveness with collaborative problem-solving

AREAS FOR IMPROVEMENT:
• Develop stronger value alignment language to understand counterpart needs
• Enhance flexibility indicators to show adaptability during negotiations
• Strengthen empathy acknowledgment to build rapport and trust
• Improve concession framing to create win-win scenarios

STRATEGIC RECOMMENDATIONS:
• Practice active listening techniques to better understand underlying interests
• Develop a repertoire of collaborative language patterns for difficult conversations
• Work on strategic questioning to uncover hidden value opportunities
• Focus on reframing challenges as shared problems to solve together`;
        }
      }

      // Generate communication insights
      async function generateCommunicationInsights(transcript, quantitativeScores, qualitativeScores) {
        if (!transcript || typeof transcript !== 'string') {
          return 'Unable to generate communication insights - invalid transcript data';
        }
        
        try {
          const prompt = `You are an expert negotiation communication consultant analyzing communication effectiveness in this negotiation transcript. Focus on strategic messaging, persuasive communication, and relationship-preserving assertiveness.

Analyze this negotiation transcript specifically for communication effectiveness. Provide insights in this format:

COMMUNICATION STRENGTHS:
• [List 3-4 specific communication strengths observed in areas like strategic messaging, persuasive language, or relationship management]

COMMUNICATION CHALLENGES:
• [List 3-4 communication areas that need improvement for enhanced negotiation effectiveness]

COMMUNICATION RECOMMENDATIONS:
• [List 3-4 specific recommendations for better strategic communication in negotiations]

Transcript: "${transcript}"

Focus specifically on negotiation communication excellence: tone control under pressure, clarity of expression during complex discussions, active listening indicators, persuasive language effectiveness, emotional intelligence in high-stakes communication, strategic messaging for deal advancement, and balanced assertiveness techniques. Evaluate against professional negotiation communication standards.`;

          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${window.GEMINI_API_KEY}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              contents: [{
                parts: [{
                  text: prompt
                }]
              }]
            })
          });

          const data = await response.json();
          return data.candidates[0].content.parts[0].text;
        } catch (error) {
          console.error("Error generating communication insights:", error);
          return `COMMUNICATION STRENGTHS:
• Clear articulation of position and requirements
• Professional tone maintained throughout discussion
• Demonstrated active listening through acknowledgment phrases
• Strategic use of questioning to gather information

COMMUNICATION CHALLENGES:
• Limited use of value alignment language to understand counterpart needs
• Opportunity to improve empathy acknowledgment for better rapport
• Could enhance flexibility indicators in communication style
• Room for improvement in collaborative framing of proposals

COMMUNICATION RECOMMENDATIONS:
• Practice reflective listening techniques to show understanding
• Develop a repertoire of empathy phrases for difficult conversations
• Work on collaborative language patterns that build partnerships
• Focus on tone control during high-pressure negotiation moments`;
        }
      }

      // Generate actionable feedback
      async function generateActionableFeedback(transcript, quantitativeScores, qualitativeScores) {
        if (!transcript || typeof transcript !== 'string') {
          return 'Unable to generate actionable feedback - invalid transcript data';
        }
        
        try {
          const prompt = `You are an expert negotiation coach providing actionable development feedback based on this negotiation transcript. Focus on strategic communication enhancement, deal-making skill development, and collaborative problem-solving mastery.

Based on this negotiation transcript, provide specific, actionable feedback for improvement:

IMMEDIATE ACTIONS:
• [List 3-4 specific actions to take in the next negotiation for enhanced strategic communication and deal-making effectiveness]

PRACTICE EXERCISES:
• [List 3-4 specific exercises to improve negotiation skills, strategic empathy, and balanced assertiveness]

LONG-TERM DEVELOPMENT:
• [List 3-4 strategic development goals for negotiation mastery and collaborative problem-solving excellence]

Transcript: "${transcript}"

Make all feedback specific, actionable, and focused on practical improvement in negotiation effectiveness, strategic communication, deal-making skills, and collaborative problem-solving. Consider professional negotiation standards and strategic communication benchmarks.`;

          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${window.GEMINI_API_KEY}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              contents: [{
                parts: [{
                  text: prompt
                }]
              }]
            })
          });

          const data = await response.json();
          return data.candidates[0].content.parts[0].text;
        } catch (error) {
          console.error("Error generating actionable feedback:", error);
          return `IMMEDIATE ACTIONS:
• Before your next negotiation, prepare 3-5 value alignment questions
• Practice using "What if we..." language to introduce creative alternatives
• Develop 2-3 concession framing phrases for difficult moments
• Create a brief empathy acknowledgment script for common concerns

PRACTICE EXERCISES:
• Role-play negotiations with colleagues focusing on collaborative language
• Record yourself practicing difficult conversations and review tone control
• Practice active listening by summarizing counterpart positions before responding
• Develop a personal negotiation phrase bank for different scenarios

LONG-TERM DEVELOPMENT:
• Study advanced negotiation techniques like principled negotiation
• Work with a coach or mentor to develop your negotiation style
• Join negotiation practice groups or take formal negotiation training
• Build a systematic approach to negotiation preparation and strategy`;
        }
      }

      // Display results functions
      function displayResults(results) {
        console.log("🎨 Displaying negotiation results:", results);
        
        if (results.transcript) {
          document.getElementById('transcriptContent').innerHTML = `
            <div class="transcript-text">
              ${results.transcript}
            </div>
          `;
        }

        displayDetailedInsights(results.insights, results.overallScore);
        displayQuantitativeMetrics(results.quantitativeScores);
        displayQualitativeMetrics(results.qualitativeScores);
        displayCommunicationInsights(results.communicationInsights);
        displayActionableFeedback(results.actionableFeedback);
      }

      function displayDetailedInsights(insights, overallScore) {
        const insightsElement = document.getElementById('detailedAnalysisContent');
        if (!insightsElement || !insights) return;

        const sections = ['NEGOTIATION STRENGTHS:', 'AREAS FOR IMPROVEMENT:', 'STRATEGIC RECOMMENDATIONS:'];
        let insightsHtml = '';

        // Overall Performance Assessment
        let performanceHtml = '';
        let performanceColor = '';
        let performanceIcon = '';
        
        if (overallScore >= 8) {
          performanceHtml = `
            <div style="margin-bottom: 1.5rem;">
              <span style="display: inline-block; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.875rem;">
                Score: ${Math.round(overallScore * 10)}/100
              </span>
            </div>
            <h4 style="font-size: 1.25rem; font-weight: 700; color: var(--negotiation-text-primary); margin-bottom: 1rem;">
              Excellent Negotiation Skills
            </h4>
            <p style="color: var(--negotiation-text-secondary); line-height: 1.7; margin-bottom: 1.5rem;">
              You demonstrate outstanding negotiation abilities with excellent strategic thinking, collaborative approach, and effective communication throughout the process.
            </p>
            <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.2);">
              <p style="font-weight: 600; color: var(--negotiation-text-primary); margin-bottom: 0.5rem;">Key Strengths Observed:</p>
              <p style="color: var(--negotiation-text-secondary); margin: 0;">
                Strategic empathy • Collaborative framing • Assertive clarity • Win-win mindset
              </p>
            </div>
          `;
          performanceColor = 'excellent';
          performanceIcon = 'check-circle';
        } else if (overallScore >= 6.5) {
          performanceHtml = `
            <div style="margin-bottom: 1.5rem;">
              <span style="display: inline-block; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.875rem;">
                Score: ${Math.round(overallScore * 10)}/100
              </span>
            </div>
            <h4 style="font-size: 1.25rem; font-weight: 700; color: var(--negotiation-text-primary); margin-bottom: 1rem;">
              Strong Foundation with Growth Potential
            </h4>
            <p style="color: var(--negotiation-text-secondary); line-height: 1.7; margin-bottom: 1.5rem;">
              You show solid negotiation fundamentals with clear areas for enhancement. With focused practice, you can develop into an exceptional negotiator.
            </p>
            <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(245, 158, 11, 0.2);">
              <p style="font-weight: 600; color: var(--negotiation-text-primary); margin-bottom: 0.5rem;">Focus Areas:</p>
              <p style="color: var(--negotiation-text-secondary); margin: 0;">
                Value alignment • Flexibility indicators • Empathy acknowledgment • Collaborative framing
              </p>
            </div>
          `;
          performanceColor = 'good';
          performanceIcon = 'trending-up';
        } else {
          performanceHtml = `
            <div style="margin-bottom: 1.5rem;">
              <span style="display: inline-block; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.875rem;">
                Score: ${Math.round(overallScore * 10)}/100
              </span>
            </div>
            <h4 style="font-size: 1.25rem; font-weight: 700; color: var(--negotiation-text-primary); margin-bottom: 1rem;">
              Great Starting Point for Growth
            </h4>
            <p style="color: var(--negotiation-text-secondary); line-height: 1.7; margin-bottom: 1.5rem;">
              Everyone starts somewhere, and you've taken an important step by seeking feedback. Negotiation skills are highly learnable with consistent practice.
            </p>
            <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(239, 68, 68, 0.2);">
              <p style="font-weight: 600; color: var(--negotiation-text-primary); margin-bottom: 0.5rem;">Building Blocks:</p>
              <p style="color: var(--negotiation-text-secondary); margin: 0;">
                Strategic thinking • Empathy development • Communication clarity • Collaborative approach
              </p>
            </div>
          `;
          performanceColor = 'needs-improvement';
          performanceIcon = 'alert-circle';
        }

        insightsHtml += `
          <div class="insight-card-modern performance">
            <div class="insight-header-modern">
              <div class="insight-icon-modern ${performanceColor}">
                <i data-lucide="${performanceIcon}"></i>
              </div>
              <h4 class="insight-title-modern">Overall Assessment</h4>
            </div>
            <div class="insight-content-modern">
              ${performanceHtml}
            </div>
          </div>
        `;

        sections.forEach(section => {
          const match = insights.match(new RegExp(`${section}([\\s\\S]*?)(?=${sections.find(s => s !== section) || '$'})`, 'i'));
          if (match) {
            const content = match[1].trim();
            const title = section.replace(':', '').replace('NEGOTIATION ', '').replace('STRATEGIC ', '');
            let color = 'var(--negotiation-primary)';
            let icon = 'lightbulb';
            
            if (section.includes('STRENGTHS')) {
              color = 'var(--negotiation-success)';
              icon = 'check-circle';
            } else if (section.includes('IMPROVEMENT')) {
              color = 'var(--negotiation-warning)';
              icon = 'alert-triangle';
            } else if (section.includes('RECOMMENDATIONS')) {
              color = 'var(--negotiation-primary)';
              icon = 'compass';
            }
            
            insightsHtml += `
              <div class="insight-card-modern">
                <div class="insight-header-modern">
                  <div class="insight-icon-modern" style="background: ${color};">
                    <i data-lucide="${icon}"></i>
                  </div>
                  <h4 class="insight-title-modern">${title}</h4>
                </div>
                <div class="insight-content-modern">
                  ${content.replace(/•/g, '&bull;')}
                </div>
              </div>
            `;
          }
        });

        insightsElement.innerHTML = insightsHtml;

        // Update score display
        document.getElementById('scoreCircle').textContent = Math.round(overallScore * 10);
        document.getElementById('scoreText').textContent = `${Math.round(overallScore * 10)}/100`;
        
        if (overallScore >= 8) {
          document.getElementById('scoreDescription').textContent = "Excellent negotiation skills with strategic thinking and collaborative approach";
        } else if (overallScore >= 6.5) {
          document.getElementById('scoreDescription').textContent = "Strong foundation with clear opportunities for strategic growth";
        } else {
          document.getElementById('scoreDescription').textContent = "Solid starting point with significant potential for negotiation improvement";
        }
      }

      function displayQuantitativeMetrics(scores) {
        const quantitativeElement = document.getElementById('quantitativeContent');
        if (!quantitativeElement || !scores) return;

        let html = '<div class="metrics-grid">';
        
        Object.entries(scores).forEach(([metric, value]) => {
          const config = negotiationMetrics.quantitative[metric] || { optimal: { min: 0, max: 100 } };
          const optimal = config.optimal;
          
          let score;
          if (value >= optimal.min && value <= optimal.max) {
            score = 100;
          } else if (value < optimal.min) {
            score = Math.max(0, 100 - (optimal.min - value) * 20);
          } else {
            score = Math.max(0, 100 - (value - optimal.max) * 20);
          }
          
          score = Math.min(100, Math.max(0, score));
          const scoreColor = score >= 80 ? '#10b981' : score >= 60 ? '#f59e0b' : score >= 40 ? '#ef4444' : '#dc2626';
          
          html += `
            <div class="metric-card">
              <div class="metric-header">
                <span class="metric-name">${metric}</span>
                <span class="metric-score" style="color: ${scoreColor};">${Math.round(score)}/100</span>
              </div>
              <div class="metric-details">
                <div style="font-weight: 500;">Measured: ${formatMetricValue(metric, value)}</div>
                <div style="color: var(--negotiation-text-muted); font-size: 0.75rem; margin-top: 0.25rem;">
                  ${config.description || 'Negotiation effectiveness indicator'}
                </div>
                <div style="color: var(--negotiation-text-muted); font-size: 0.75rem;">
                  Ideal: ${config.ideal || `${optimal.min}-${optimal.max}`}
                </div>
              </div>
              <div class="metric-bar">
                <div class="metric-fill" style="width: ${score}%; background-color: ${scoreColor};"></div>
              </div>
            </div>
          `;
        });
        
        html += '</div>';
        quantitativeElement.innerHTML = html;
      }

      function displayQualitativeMetrics(scores) {
        const qualitativeElement = document.getElementById('qualitativeContent');
        if (!qualitativeElement || !scores) return;

        let html = '<div class="categories-grid">';
        
        Object.entries(scores).forEach(([metric, score]) => {
          const config = negotiationMetrics.qualitative[metric] || { factors: [] };
          const normalizedScore = (score / 10) * 100;
          const scoreColor = normalizedScore >= 80 ? '#10b981' : normalizedScore >= 60 ? '#f59e0b' : normalizedScore >= 40 ? '#ef4444' : '#dc2626';
          
          html += `
            <div class="category-card">
              <div class="category-header">
                <span class="category-name">${metric}</span>
                <span class="category-score" style="color: ${scoreColor};">${score}/10</span>
              </div>
              <div style="color: var(--negotiation-text-muted); font-size: 0.8rem; margin-bottom: 0.75rem;">
                ${config.description || 'Negotiation skill assessment'}
              </div>
              <div class="category-factors">
                ${config.factors.map(factor => `<span class="factor-tag">${factor}</span>`).join('')}
              </div>
              <div class="category-bar">
                <div class="category-fill" style="width: ${normalizedScore}%; background-color: ${scoreColor};"></div>
              </div>
            </div>
          `;
        });
        
        html += '</div>';
        qualitativeElement.innerHTML = html;
      }

      function displayCommunicationInsights(insights) {
        const communicationElement = document.getElementById('communicationContent');
        if (!communicationElement || !insights) return;

        const sections = ['COMMUNICATION STRENGTHS:', 'COMMUNICATION CHALLENGES:', 'COMMUNICATION RECOMMENDATIONS:'];
        let insightsHtml = '';

        sections.forEach(section => {
          const match = insights.match(new RegExp(`${section}([\\s\\S]*?)(?=${sections.find(s => s !== section) || '$'})`, 'i'));
          if (match) {
            const content = match[1].trim();
            const title = section.replace(':', '').replace('COMMUNICATION ', '');
            let color = 'var(--negotiation-primary)';
            let icon = 'message-circle';
            
            if (section.includes('STRENGTHS')) {
              color = 'var(--negotiation-success)';
              icon = 'check-circle';
            } else if (section.includes('CHALLENGES')) {
              color = 'var(--negotiation-warning)';
              icon = 'alert-triangle';
            } else if (section.includes('RECOMMENDATIONS')) {
              color = 'var(--negotiation-primary)';
              icon = 'compass';
            }
            
            insightsHtml += `
              <div class="insight-card-modern">
                <div class="insight-header-modern">
                  <div class="insight-icon-modern" style="background: ${color};">
                    <i data-lucide="${icon}"></i>
                  </div>
                  <h4 class="insight-title-modern">${title}</h4>
                </div>
                <div class="insight-content-modern">
                  ${content.replace(/•/g, '&bull;')}
                </div>
              </div>
            `;
          }
        });

        communicationElement.innerHTML = insightsHtml;
      }

      function displayActionableFeedback(feedback) {
        const feedbackElement = document.getElementById('feedbackContent');
        if (!feedbackElement || !feedback) return;

        const sections = ['IMMEDIATE ACTIONS:', 'PRACTICE EXERCISES:', 'LONG-TERM DEVELOPMENT:'];
        let feedbackHtml = '';

        sections.forEach(section => {
          const match = feedback.match(new RegExp(`${section}([\\s\\S]*?)(?=${sections.find(s => s !== section) || '$'})`, 'i'));
          if (match) {
            const content = match[1].trim();
            const title = section.replace(':', '').replace('-TERM', '-Term');
            let color = 'var(--negotiation-primary)';
            let icon = 'clipboard-check';
            
            if (section.includes('IMMEDIATE')) {
              color = 'var(--negotiation-warning)';
              icon = 'zap';
            } else if (section.includes('PRACTICE')) {
              color = 'var(--negotiation-accent)';
              icon = 'repeat';
            } else if (section.includes('LONG-TERM')) {
              color = 'var(--negotiation-primary)';
              icon = 'target';
            }
            
            feedbackHtml += `
              <div class="insight-card-modern">
                <div class="insight-header-modern">
                  <div class="insight-icon-modern" style="background: ${color};">
                    <i data-lucide="${icon}"></i>
                  </div>
                  <h4 class="insight-title-modern">${title}</h4>
                </div>
                <div class="insight-content-modern">
                  ${content.replace(/•/g, '&bull;')}
                </div>
              </div>
            `;
          }
        });

        feedbackElement.innerHTML = feedbackHtml;
      }

      function formatMetricValue(metric, value) {
        const units = {
          'Value Alignment Phrasing': '',
          'Flexibility Indicator': '',
          'Assertive Ask Ratio': '',
          'Empathy Acknowledgment Density': '',
          'Concession Framing Presence': '',
          'Tone Control Score': '',
          'Trade Summary Clarity': ''
        };
        
        if (metric === 'Assertive Ask Ratio' || metric === 'Tone Control Score') {
          return (value * 100).toFixed(0) + '%';
        }
        
        return value + (units[metric] || '');
      }

      // Copy functions
      function copyAnalysis() {
        const analysisContent = document.getElementById('detailedAnalysisContent');
        if (analysisContent) {
          const textContent = analysisContent.innerText;
          navigator.clipboard.writeText(textContent);
          
          // Show feedback
          const btn = event.target.closest('.copy-btn');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i data-lucide="check"></i> Copied!';
          btn.style.background = 'var(--negotiation-success)';
          btn.style.color = 'white';
          
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = 'rgba(255, 255, 255, 0.6)';
            btn.style.color = 'var(--negotiation-text-secondary)';
          }, 2000);
        }
      }

      function copyQuantitative() {
        const quantContent = document.getElementById('quantitativeContent');
        if (quantContent) {
          const textContent = quantContent.innerText;
          navigator.clipboard.writeText(textContent);
          
          // Show feedback
          const btn = event.target.closest('.copy-btn');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i data-lucide="check"></i> Copied!';
          btn.style.background = 'var(--negotiation-success)';
          btn.style.color = 'white';
          
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = 'rgba(255, 255, 255, 0.6)';
            btn.style.color = 'var(--negotiation-text-secondary)';
          }, 2000);
        }
      }

      function copyQualitative() {
        const qualContent = document.getElementById('qualitativeContent');
        if (qualContent) {
          const textContent = qualContent.innerText;
          navigator.clipboard.writeText(textContent);
          
          // Show feedback
          const btn = event.target.closest('.copy-btn');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i data-lucide="check"></i> Copied!';
          btn.style.background = 'var(--negotiation-success)';
          btn.style.color = 'white';
          
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = 'rgba(255, 255, 255, 0.6)';
            btn.style.color = 'var(--negotiation-text-secondary)';
          }, 2000);
        }
      }

      function copyCommunication() {
        const commContent = document.getElementById('communicationContent');
        if (commContent) {
          const textContent = commContent.innerText;
          navigator.clipboard.writeText(textContent);
          
          // Show feedback
          const btn = event.target.closest('.copy-btn');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i data-lucide="check"></i> Copied!';
          btn.style.background = 'var(--negotiation-success)';
          btn.style.color = 'white';
          
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = 'rgba(255, 255, 255, 0.6)';
            btn.style.color = 'var(--negotiation-text-secondary)';
          }, 2000);
        }
      }

      function copyFeedback() {
        const feedbackContent = document.getElementById('feedbackContent');
        if (feedbackContent) {
          const textContent = feedbackContent.innerText;
          navigator.clipboard.writeText(textContent);
          
          // Show feedback
          const btn = event.target.closest('.copy-btn');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i data-lucide="check"></i> Copied!';
          btn.style.background = 'var(--negotiation-success)';
          btn.style.color = 'white';
          
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = 'rgba(255, 255, 255, 0.6)';
            btn.style.color = 'var(--negotiation-text-secondary)';
          }, 2000);
        }
      }

      // Process audio for transcription
      async function processAudioForTranscription(audioDataString) {
        try {
          console.log("🎤 Processing negotiation audio for transcription");

          const audioData = JSON.parse(audioDataString);
          console.log("📊 Audio data:", audioData);

          const response = await fetch(audioData.base64);
          const blob = await response.blob();
          const audioFile = new File([blob], audioData.name, { type: audioData.type });

          const transcript = await transcribeAudioWithGemini(audioFile);
          const analysisResults = await analyzeNegotiation(transcript);

          console.log("✅ Negotiation analysis complete:", analysisResults);
          displayResults(analysisResults);

        } catch (error) {
          console.error("❌ Audio processing failed:", error);
          document.getElementById("transcriptContent").innerHTML = `
            <div style="text-align: center; padding: 2rem; background: #fef2f2; border: 2px solid #fca5a5; border-radius: 12px; color: #dc2626;">
              <h3>⚠️ Analysis Failed</h3>
              <p>Unable to process your negotiation. Please try again.</p>
              <p style="font-size: 14px; opacity: 0.8;">Error: ${error.message}</p>
            </div>
          `;
        }
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        lucide.createIcons();
        initializeUnifiedTabSwitching();

        const audioData = sessionStorage.getItem("audioForAnalysis");
        if (audioData) {
          console.log("🎤 Found audio data for negotiation analysis");
          processAudioForTranscription(audioData);
          sessionStorage.removeItem("audioForAnalysis");
        } else {
          console.log("❌ No audio data found");
          document.getElementById("transcriptContent").innerHTML = `
            <div style="text-align: center; padding: 2rem;">
              <h3>No Audio Data</h3>
              <p>Please record a negotiation first.</p>
              <a href="dashboard.html" class="back-btn" style="margin-top: 1rem;">
                Go to Dashboard
              </a>
            </div>
          `;
        }
      });
    </script>
  </body>
</html>