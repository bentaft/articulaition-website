<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="AI-Powered Storytelling Analysis Results - Articulaition"
    />
    <title>Storytelling Analysis Results - Articulaition</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/variables.css" />
    <link rel="stylesheet" href="css/base.css" />

    <style>
      /* ==========================================================================
         SOPHISTICATED STORYTELLING COMMUNICATION DESIGN SYSTEM
         ========================================================================== */
      :root {
        /* Storytelling Communication Color Palette - Creative & Inspiring */
        --voice-primary: #6366f1;
        --voice-secondary: #8b5cf6;
        --voice-accent: #06b6d4;
        --voice-warm: #f59e0b;
        --voice-success: #10b981;
        --voice-neural: #64748b;
        --voice-dark: #2d3748;
        --voice-light: #f7fafc;
        --voice-bg-primary: #fafbfc;
        --voice-bg-secondary: #f4f6f8;
        --voice-glass: rgba(255, 255, 255, 0.85);
        --voice-glass-border: rgba(255, 255, 255, 0.3);
        --voice-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08);
        --voice-shadow-lg: 0 35px 60px -12px rgba(0, 0, 0, 0.12);
        --voice-text-primary: #1a202c;
        --voice-text-secondary: #4a5568;
        --voice-text-muted: #718096;
        
        /* Storytelling Accent Colors */
        --storytelling-primary: #7c3aed;
        --storytelling-secondary: #a855f7;
        --storytelling-success: #10b981;
        --storytelling-warning: #f59e0b;
        --storytelling-light: rgba(124, 58, 237, 0.05);
        
        /* Typography */
        --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        
        /* Spacing */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;
        
        /* Radius */
        --radius: 0.75rem;
        --radius-sm: 0.5rem;
        --radius-lg: 1rem;
        
        /* Glass Morphism Shadows */
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      /* ==========================================================================
         BASE STYLES WITH SOPHISTICATED BACKGROUND
         ========================================================================== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: var(--font-sans);
        background: linear-gradient(135deg, #fafbfc 0%, #f4f6f8 25%, #edf2f7 50%, #e2e8f0 75%, #cbd5e0 100%);
        color: var(--voice-text-primary);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
      }

      /* Background Effects */
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
          radial-gradient(circle at 20% 20%, rgba(124, 58, 237, 0.03) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(168, 85, 247, 0.025) 0%, transparent 50%),
          radial-gradient(circle at 20% 80%, rgba(6, 182, 212, 0.02) 0%, transparent 50%),
          radial-gradient(circle at 80% 80%, rgba(99, 102, 241, 0.015) 0%, transparent 50%);
        pointer-events: none;
        z-index: -1;
      }

      /* Animation Classes */
      .fade-in {
        animation: fadeIn 1s ease-out forwards;
        opacity: 0;
      }

      .slide-up {
        animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0;
        transform: translateY(30px);
      }

      .scale-in {
        animation: scaleIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0;
        transform: scale(0.9);
      }

      @keyframes fadeIn {
        to { opacity: 1; }
      }
      @keyframes slideUp {
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes scaleIn {
        to { opacity: 1; transform: scale(1); }
      }

      .delay-100 { animation-delay: 0.1s; }
      .delay-200 { animation-delay: 0.2s; }
      .delay-300 { animation-delay: 0.3s; }
      .delay-400 { animation-delay: 0.4s; }
      .delay-500 { animation-delay: 0.5s; }

      /* ==========================================================================
         TOP NAVIGATION WITH GLASS MORPHISM
         ========================================================================== */
      .top-nav {
        padding: 1.5rem 2.5rem;
        background: var(--voice-glass);
        backdrop-filter: blur(25px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--voice-shadow);
      }

      .logo-section {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .logo-section img {
        height: 36px;
        filter: none;
        transition: transform 0.3s ease;
      }

      .logo-section:hover img {
        transform: scale(1.05);
      }

      /* Navigation Branding with Shiny Effect */
      .nav-orange {
          background: linear-gradient(
              145deg,
              #ff934d 0%,
              #ffb366 30%,
              #ff7f50 60%,
              #ff934d 100%
          );
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          filter: drop-shadow(0 2px 4px rgba(255, 147, 77, 0.3));
      }

      .nav-blue {
          background: linear-gradient(
              145deg,
              #4a90e2 0%,
              #6bb6ff 30%,
              #4f94e8 60%,
              #4a90e2 100%
          );
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          filter: drop-shadow(0 2px 4px rgba(74, 144, 226, 0.3));
      }

      .nav-links {
        display: flex;
        gap: 2rem;
      }

      .nav-link {
        color: var(--voice-text-secondary);
        text-decoration: none;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        position: relative;
      }

      .nav-link.active {
        color: var(--voice-primary);
        background: transparent;
        border: none;
        border-bottom: 2px solid #4a90e2;
        border-radius: 0;
        padding-bottom: 0.4rem;
      }

      .nav-link:hover:not(.active) {
        color: var(--voice-text-primary);
        background: rgba(0, 0, 0, 0.05);
      }

      .user-menu {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--storytelling-primary),
          var(--storytelling-secondary)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.875rem;
      }

      .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, var(--storytelling-primary), var(--storytelling-secondary));
        color: white;
        text-decoration: none;
        border-radius: 12px;
        font-weight: 500;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
      }

      .back-btn:hover {
        background: linear-gradient(135deg, var(--storytelling-secondary), var(--storytelling-primary));
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      /* ==========================================================================
         MISSING UTILITY CLASSES
         ========================================================================== */
      .flex { display: flex; }
      .items-center { align-items: center; }
      .gap-3 { gap: 0.75rem; }
      .gap-4 { gap: 1rem; }
      .relative { position: relative; }
      .group:hover .group-hover\\:scale-105 { transform: scale(1.05); }
      .h-9 { height: 2.25rem; }
      .w-auto { width: auto; }
      .font-semibold { font-weight: 600; }
      .text-lg { font-size: 1.125rem; }
      .tracking-tight { letter-spacing: -0.025em; }
      .transition-transform { transition: transform 0.3s ease; }

      .analysis-info {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 0.25rem;
      }

      .analysis-badge {
        background: linear-gradient(135deg, var(--voice-primary), var(--voice-secondary));
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .user-menu-btn {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem 1rem;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(0, 0, 0, 0.05);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .user-menu-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-1px);
      }

      .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--voice-primary), var(--voice-secondary));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.875rem;
      }

      /* Glass Effect */
      .glass-intense {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      /* ==========================================================================
         PAGE HEADER
         ========================================================================== */
      .page-header {
        background: white;
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        padding: var(--space-4) var(--space-8);
      }
      
      .header-content h1 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--voice-text-primary);
        margin-bottom: var(--space-2);
      }

      /* ==========================================================================
         MAIN LAYOUT
         ========================================================================== */
      .main-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--space-8);
      }
      
      /* Score Section at Top with Glass Morphism */
      .score-section {
        background: var(--voice-glass);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: 24px;
        box-shadow: var(--voice-shadow-lg);
        padding: var(--space-6) var(--space-8);
        margin-bottom: var(--space-6);
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .score-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.02) 0%, transparent 100%);
        pointer-events: none;
      }
      
      .score-header {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--voice-text-secondary);
        margin-bottom: var(--space-4);
        position: relative;
        z-index: 2;
      }
      
      .score-display {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-6);
      }
      
      .score-circle {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--storytelling-primary) 0%, var(--storytelling-secondary) 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.25rem;
        font-weight: 800;
        box-shadow: 0 25px 50px -12px rgba(124, 58, 237, 0.4), 0 15px 25px -8px rgba(124, 58, 237, 0.25);
        flex-shrink: 0;
        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        border: 4px solid rgba(255, 255, 255, 0.3);
        position: relative;
        z-index: 2;
      }

      .score-circle::before {
        content: '';
        position: absolute;
        top: -4px;
        left: -4px;
        right: -4px;
        bottom: -4px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.2) 0%, rgba(168, 85, 247, 0.1) 100%);
        z-index: -1;
        transition: all 0.4s ease;
      }
      
      .score-circle:hover {
        transform: translateY(-4px) scale(1.05);
        box-shadow: 0 35px 70px -12px rgba(124, 58, 237, 0.5), 0 20px 35px -8px rgba(124, 58, 237, 0.35);
      }

      .score-circle:hover::before {
        transform: scale(1.1);
        opacity: 0.8;
      }
      
      .score-details {
        text-align: left;
        position: relative;
        z-index: 2;
      }
      
      .score-label {
        font-size: 1rem;
        color: var(--voice-text-secondary);
        margin-bottom: var(--space-2);
        font-weight: 600;
      }
      
      .score-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--voice-text-primary);
        margin-bottom: var(--space-3);
        line-height: 1;
      }
      
      .score-description {
        font-size: 1rem;
        color: var(--voice-text-secondary);
        font-weight: 500;
        padding: var(--space-2) var(--space-4);
        background: linear-gradient(135deg, #faf5ff, #f3e8ff);
        border-radius: 8px;
        border: 1px solid #e9d5ff;
      }
      
      /* Analysis Panels Layout */
      .analysis-panels {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-6);
        height: calc(100vh - 320px);
      }

      /* ==========================================================================
         TRANSCRIPT PANEL WITH GLASS MORPHISM
         ========================================================================== */
      .transcript-panel {
        background: var(--voice-glass);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: 24px;
        box-shadow: var(--voice-shadow-lg);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: all 0.3s ease;
        position: relative;
      }

      .transcript-panel::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.01) 0%, transparent 100%);
        pointer-events: none;
      }

      .transcript-panel:hover {
        transform: translateY(-2px);
        box-shadow: var(--voice-shadow-lg), 0 8px 25px rgba(0, 0, 0, 0.08);
      }

      .transcript-header {
        padding: var(--space-5) var(--space-6);
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(15px);
        position: relative;
        z-index: 2;
        display: flex;
        align-items: center;
        gap: var(--space-3);
      }

      .transcript-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--voice-text-primary);
        margin: 0;
      }

      .transcript-content {
        flex: 1;
        padding: var(--space-6);
        overflow-y: auto;
        position: relative;
        z-index: 2;
      }

      .transcript-text {
        line-height: 1.8;
        color: var(--voice-text-secondary);
        background: var(--storytelling-light);
        padding: var(--space-6);
        border-radius: var(--radius);
        border-left: 4px solid var(--storytelling-primary);
        font-size: 0.95rem;
      }

      /* ==========================================================================
         UNIFIED ANALYSIS PANEL WITH GLASS MORPHISM
         ========================================================================== */
      .unified-analysis-panel {
        background: var(--voice-glass);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: 24px;
        box-shadow: var(--voice-shadow-lg);
        overflow: hidden;
        height: fit-content;
        min-height: 600px;
        transition: all 0.3s ease;
        position: relative;
      }

      .unified-analysis-panel::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.01) 0%, transparent 100%);
        pointer-events: none;
      }

      .unified-analysis-panel:hover {
        transform: translateY(-2px);
        box-shadow: var(--voice-shadow-lg), 0 8px 25px rgba(0, 0, 0, 0.08);
      }

      .unified-tab-header {
        display: flex;
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(15px);
        position: relative;
        z-index: 2;
      }
      
      .unified-tab-btn {
        flex: 1;
        padding: var(--space-4) var(--space-5);
        background: none;
        border: none;
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--voice-text-secondary);
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
        border-radius: 12px 12px 0 0;
      }
      
      .unified-tab-btn:hover:not(.active) {
        background: rgba(99, 102, 241, 0.05);
        color: var(--voice-text-primary);
        transform: translateY(-1px);
      }
      
      .unified-tab-btn.active {
        background: rgba(99, 102, 241, 0.1);
        color: var(--voice-primary);
        border-bottom: 3px solid var(--voice-primary);
        transform: translateY(-1px);
      }

      .unified-tab-btn.active::before {
        content: '';
        position: absolute;
        bottom: -1px;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(135deg, var(--voice-primary), var(--voice-secondary));
        border-radius: 2px 2px 0 0;
      }

      .unified-tab-content {
        padding: var(--space-6);
        height: 450px;
        overflow-y: auto;
        overflow-x: hidden;
        position: relative;
      }

      /* Custom scrollbar for unified content */
      .unified-tab-content::-webkit-scrollbar {
        width: 6px;
      }

      .unified-tab-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 3px;
      }

      .unified-tab-content::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 3px;
      }

      .unified-tab-content::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.3);
      }

      .unified-tab-pane {
        display: none;
      }

      .unified-tab-pane.active {
        display: block;
      }

      .panel-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-6);
      }

      .panel-actions h3 {
        margin: 0;
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--voice-text-primary);
      }

      .copy-btn {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-2) var(--space-3);
        background: rgba(255, 255, 255, 0.6);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: var(--radius);
        font-size: 0.875rem;
        color: var(--voice-text-secondary);
        cursor: pointer;
        transition: all 0.2s;
      }

      .copy-btn:hover {
        background: rgba(255, 255, 255, 0.8);
        color: var(--voice-text-primary);
      }

      /* ==========================================================================
         LOADING STATES
         ========================================================================== */
      .loading-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: var(--space-8);
        color: var(--voice-text-muted);
      }
      
      .spinner {
        width: 24px;
        height: 24px;
        border: 2px solid rgba(99, 102, 241, 0.2);
        border-top: 2px solid var(--voice-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: var(--space-3);
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* ==========================================================================
         INSIGHT CARDS
         ========================================================================== */
      .insight-card-modern {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: 16px;
        margin-bottom: var(--space-5);
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      }

      .insight-card-modern:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }

      .insight-header-modern {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-5);
        background: rgba(255, 255, 255, 0.5);
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      }

      .insight-icon-modern {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, var(--voice-primary), var(--voice-secondary));
        color: white;
        flex-shrink: 0;
        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
      }

      .insight-icon-modern.excellent {
        background: linear-gradient(135deg, #10b981, #059669);
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
      }

      .insight-icon-modern.good {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
      }

      .insight-icon-modern.needs-improvement {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
      }

      .insight-title-modern {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--voice-text-primary);
        margin: 0;
      }

      .insight-content-modern {
        padding: var(--space-5);
        line-height: 1.7;
        color: var(--voice-text-secondary);
      }

      /* ==========================================================================
         METRIC CARDS
         ========================================================================== */
      .metrics-grid {
        display: grid;
        gap: var(--space-4);
      }

      .metric-card {
        background: var(--storytelling-light);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: var(--radius);
        padding: var(--space-4);
        border-left: 4px solid var(--storytelling-primary);
        transition: all 0.2s ease;
      }

      .metric-card:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow);
      }

      .metric-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-3);
      }

      .metric-name {
        font-weight: 600;
        color: var(--voice-text-primary);
        font-size: 0.9rem;
      }

      .metric-score {
        font-weight: 600;
        font-size: 0.875rem;
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius-sm);
        background: white;
      }

      .metric-details {
        margin: var(--space-2) 0;
        font-size: 0.8rem;
        color: var(--voice-text-secondary);
      }

      .metric-bar {
        height: 6px;
        background: rgba(0, 0, 0, 0.1);
        border-radius: 3px;
        overflow: hidden;
        margin-top: var(--space-2);
      }

      .metric-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      /* ==========================================================================
         QUALITATIVE CATEGORIES
         ========================================================================== */
      .categories-grid {
        display: grid;
        gap: var(--space-4);
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }

      .category-card {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 0, 0, 0.06);
        border-radius: 12px;
        padding: var(--space-5);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .category-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(135deg, var(--voice-primary), var(--voice-secondary));
      }

      .category-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        background: rgba(255, 255, 255, 0.95);
      }

      .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-3);
      }

      .category-name {
        font-weight: 600;
        color: var(--voice-text-primary);
        font-size: 0.95rem;
      }

      .category-score {
        font-weight: 700;
        font-size: 1rem;
        padding: var(--space-2) var(--space-3);
        border-radius: 8px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
        border: 1px solid rgba(0, 0, 0, 0.08);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        position: relative;
        overflow: hidden;
      }

      .category-score::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
      }

      .category-factors {
        margin: var(--space-3) 0;
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-2);
      }

      .factor-tag {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(139, 92, 246, 0.06));
        color: var(--voice-primary);
        padding: 0.375rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        border: 1px solid rgba(99, 102, 241, 0.15);
        transition: all 0.2s ease;
        text-transform: capitalize;
        letter-spacing: 0.025em;
      }

      .factor-tag:hover {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.12), rgba(139, 92, 246, 0.1));
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(99, 102, 241, 0.2);
      }

      .category-bar {
        height: 8px;
        background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
        border-radius: 12px;
        overflow: hidden;
        margin-top: var(--space-3);
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      .category-bar::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
        animation: barShimmer 3s ease-in-out infinite;
      }

      @keyframes barShimmer {
        0%, 100% { transform: translateX(-100%); }
        50% { transform: translateX(100%); }
      }

      .category-fill {
        height: 100%;
        border-radius: 12px;
        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        background: linear-gradient(135deg, var(--voice-primary) 0%, var(--voice-secondary) 50%, var(--voice-accent) 100%);
        box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
        position: relative;
        overflow: hidden;
      }

      .category-fill::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.4) 50%, transparent 100%);
        animation: fillShimmer 2s ease-in-out infinite;
      }

      @keyframes fillShimmer {
        0%, 100% { transform: translateX(-100%); }
        50% { transform: translateX(100%); }
      }

      /* ==========================================================================
         NEXT STEPS SECTION
         ========================================================================== */
      .next-steps-section {
        grid-column: 1 / -1;
        margin-top: var(--space-8);
      }

      .next-steps {
        border-left-color: var(--voice-success) !important;
      }

      .next-steps .insight-icon-modern {
        background: var(--voice-success);
      }

      /* ==========================================================================
         RESPONSIVE DESIGN
         ========================================================================== */
      @media (max-width: 1024px) {
        .analysis-panels {
          grid-template-columns: 1fr;
          gap: var(--space-6);
        }
        
        .transcript-panel,
        .unified-analysis-panel {
          height: auto;
          min-height: 400px;
        }
        
        .top-nav {
          padding: var(--space-4) var(--space-5);
        }
        
        .logo-text {
          font-size: 1.25rem;
        }
      }

      @media (max-width: 768px) {
        .main-container {
          padding: var(--space-4);
        }
        
        .unified-tab-btn {
          font-size: 0.8rem;
          padding: var(--space-3) var(--space-4);
        }
        
        .unified-tab-btn span {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <!-- Top Navigation -->
    <nav class="top-nav fade-in delay-100">
      <div class="logo-section">
        <a href="index.html" class="flex items-center gap-3 group">
          <img src="images/tree-logo.svg" alt="Tree Logo" class="h-9 w-auto group-hover:scale-105 transition-transform">
          <span class="font-semibold text-lg tracking-tight nav-brand-text">
              <span class="nav-orange">articul</span><span class="nav-blue">ai</span><span class="nav-orange">tion</span><span class="nav-orange">.com</span>
          </span>
        </a>
        <div class="nav-links">
          <a href="dashboard.html" class="nav-link">Home</a>
          <a href="professional-communication.html" class="nav-link">Professional Communication</a>
          <a href="personal-communication.html" class="nav-link active">Personal Communication</a>
          <a href="improvement-hub.html" class="nav-link">Improvement Hub</a>
          <a href="pricing.html" class="nav-link">Pricing</a>
        </div>
      </div>

      <div class="flex items-center gap-4">
        <!-- Analysis Results Info -->
        <div class="analysis-info">
          <span class="analysis-badge" id="analysisTypeBadge">Storytelling Analysis</span>
        </div>
        
        <!-- User Dropdown -->
        <div class="relative">
          <button
            class="flex items-center gap-3 px-4 py-2 rounded-xl bg-white bg-opacity-10 hover:bg-opacity-15 transition-all"
            id="userMenuBtn"
          >
            <div
              id="userAvatar"
              style="
                width: 32px;
                height: 32px;
                background: linear-gradient(135deg, #f59e0b, #f97316);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 700;
                font-size: 14px;
              "
            >
              U
            </div>
            <div style="display: flex; flex-direction: column; flex: 1; margin-left: 8px;">
              <span
                id="userName"
                style="
                  color: var(--voice-text-primary);
                  font-weight: 500;
                  font-size: 14px;
                  line-height: 1.2;
                "
                >Account</span
              >
              <span
                id="userPlan"
                style="
                  background: linear-gradient(135deg, #10b981, #06b6d4);
                  color: white;
                  padding: 2px 8px;
                  border-radius: 12px;
                  font-size: 10px;
                  font-weight: 600;
                  width: fit-content;
                  margin-top: 2px;
                "
                >Free Plan</span
              >
            </div>
            <i
              data-lucide="chevron-down"
              style="
                width: 16px;
                height: 16px;
                color: var(--voice-text-secondary);
              "
            ></i>
          </button>
          <div
            class="absolute right-0 top-full mt-2 w-48 glass-intense rounded-xl shadow-2xl border border-black border-opacity-10 hidden"
            id="userDropdown"
          >
            <a
              href="#"
              class="flex items-center gap-3 px-4 py-3 hover:bg-black hover:bg-opacity-10 rounded-t-xl"
              style="color: var(--voice-text-primary); font-weight: 400"
            >
              <i data-lucide="user" style="width: 16px; height: 16px"></i>
              <span style="font-size: 14px">Profile Settings</span>
            </a>
            <a
              href="#"
              class="flex items-center gap-3 px-4 py-3 hover:bg-black hover:bg-opacity-10"
              style="color: var(--voice-text-primary); font-weight: 400"
            >
              <i
                data-lucide="credit-card"
                style="width: 16px; height: 16px"
              ></i>
              <span style="font-size: 14px">Billing & Plans</span>
            </a>
            <a
              href="#"
              class="flex items-center gap-3 px-4 py-3 hover:bg-black hover:bg-opacity-10"
              style="color: var(--voice-text-primary); font-weight: 400"
            >
              <i data-lucide="settings" style="width: 16px; height: 16px"></i>
              <span style="font-size: 14px">Preferences</span>
            </a>
            <hr style="border-color: rgba(0, 0, 0, 0.1); margin: 8px 0" />
            <button
              class="flex items-center gap-3 px-4 py-3 hover:bg-red-500 hover:bg-opacity-20 w-full text-left text-red-400 rounded-b-xl"
              id="logoutBtn"
              style="font-weight: 400"
            >
              <i
                data-lucide="log-out"
                style="width: 16px; height: 16px"
              ></i>
              <span style="font-size: 14px">Sign Out</span>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Page Header -->
    <header class="page-header slide-up delay-200">
      <div class="header-content">
        <h1 id="resultsTitle">Storytelling Analysis Results</h1>
      </div>
    </header>

    <main class="main-container">
      <!-- Score Section at Top -->
      <div class="score-section scale-in delay-300">
        <div class="score-header">Storytelling Effectiveness Score</div>
        <div class="score-display">
          <div class="score-circle" id="scoreCircle">--</div>
          <div class="score-details">
            <div class="score-label">Storytelling Mastery</div>
            <div class="score-value" id="scoreText">Analyzing...</div>
            <div class="score-description" id="scoreDescription">
              Building your personalized storytelling development plan...
            </div>
          </div>
        </div>
      </div>

      <!-- Analysis Panels Layout -->
      <div class="analysis-panels">
        <!-- Left Panel: Transcript -->
        <div class="transcript-panel slide-up delay-400">
        <div class="transcript-header">
          <i data-lucide="file-text" style="color: var(--storytelling-primary);"></i>
          <h2 class="transcript-title">Your Story</h2>
        </div>
        <div class="transcript-content">
          <div id="transcriptContent">
            <div class="loading-state">
              <div class="spinner"></div>
              <p>Transcribing your story...</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Right Panel: Unified Analysis with 3 Tabs -->
      <div class="unified-analysis-panel slide-up delay-500">
        <!-- Tab Navigation -->
        <div class="unified-tab-header">
          <button class="unified-tab-btn active" data-tab="insights">
            <i data-lucide="lightbulb"></i>
            <span>Insights</span>
          </button>
          <button class="unified-tab-btn" data-tab="quantitative">
            <i data-lucide="bar-chart-2"></i>
            <span>Quantitative</span>
          </button>
          <button class="unified-tab-btn" data-tab="qualitative">
            <i data-lucide="pie-chart"></i>
            <span>Qualitative</span>
          </button>
        </div>
        
        <!-- Tab Content -->
        <div class="unified-tab-content">
          <!-- Insights Tab -->
          <div class="unified-tab-pane active" id="insights-pane">
            <div class="panel-actions">
              <h3>Storytelling Insights</h3>
              <button class="copy-btn" onclick="copyAnalysis()">
                <i data-lucide="copy"></i>
                Copy Feedback
              </button>
            </div>
            <div id="detailedAnalysisContent">
              <div class="loading-state">
                <div class="spinner"></div>
                <p>Analyzing your storytelling approach...</p>
              </div>
            </div>
          </div>
          
          <!-- Quantitative Tab -->
          <div class="unified-tab-pane" id="quantitative-pane">
            <div class="panel-actions">
              <h3>Story Metrics</h3>
              <button class="copy-btn" onclick="copyQuantitative()">
                <i data-lucide="copy"></i>
                Copy Data
              </button>
            </div>
            <div id="quantitativeContent">
              <div class="loading-state">
                <div class="spinner"></div>
                <p>Measuring narrative structure and timing...</p>
              </div>
            </div>
          </div>
          
          <!-- Qualitative Tab -->
          <div class="unified-tab-pane" id="qualitative-pane">
            <div class="panel-actions">
              <h3>Narrative Skills</h3>
              <button class="copy-btn" onclick="copyQualitative()">
                <i data-lucide="copy"></i>
                Copy Analysis
              </button>
            </div>
            <div id="qualitativeContent">
              <div class="loading-state">
                <div class="spinner"></div>
                <p>Evaluating emotional impact and engagement...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Enhanced Next Steps Section -->
      <div class="next-steps-section">
        <div class="insight-card-modern next-steps" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9)); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
          <div class="insight-header-modern">
            <div class="insight-icon-modern" style="background: linear-gradient(135deg, var(--voice-primary), var(--voice-secondary)); animation: pulse 2s infinite;">
              <i data-lucide="target"></i>
            </div>
            <h3 class="insight-title-modern" style="font-size: 1.5rem; color: var(--voice-text-primary); font-weight: 700;">Your Next Steps</h3>
          </div>
          <div class="insight-content-modern">
            <!-- Hero Message -->
            <div style="margin-bottom: 3rem; text-align: center; padding: 2.5rem 2rem; background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9)); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);">
              <div style="max-width: 600px; margin: 0 auto;">
                <h4 style="font-size: 2.25rem; font-weight: 800; background: linear-gradient(135deg, var(--voice-primary), var(--voice-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0 0 1rem 0; line-height: 1.2;">
                  Transform Your Communication
                </h4>
                <p style="color: var(--voice-text-secondary); line-height: 1.8; margin: 0; font-size: 1.125rem; font-weight: 400;">
                  You've unlocked professional insights that transform how you communicate. Choose your growth path and turn these discoveries into <strong style="color: var(--voice-primary);">exponential progress</strong>.
                </p>
              </div>
            </div>
            
            
            <!-- Premium Pricing Section -->
            <div style="background: linear-gradient(135deg, rgba(248, 250, 252, 0.95), rgba(241, 245, 249, 0.98)); padding: 2rem; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.8); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.06); backdrop-filter: blur(10px); margin-bottom: 2rem; position: relative; overflow: hidden;">
              
              <!-- Collapsible Header -->
              <div style="position: relative; z-index: 1; cursor: pointer;" onclick="togglePricingSection()">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                  <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(255, 255, 255, 0.8); padding: 0.5rem 1rem; border-radius: 50px; border: 1px solid rgba(0, 0, 0, 0.1);">
                      <i data-lucide="rocket" style="width: 16px; height: 16px; color: var(--voice-primary);"></i>
                      <span style="font-size: 0.875rem; font-weight: 600; color: var(--voice-primary);">Choose Your Growth Path</span>
                    </div>
                    <div>
                      <h4 style="font-size: 1.5rem; font-weight: 800; color: var(--voice-text-primary); margin: 0; line-height: 1.2;">Plans Built for Every Stage</h4>
                      <p style="font-size: 0.875rem; color: var(--voice-text-secondary); margin: 0.25rem 0 0 0; font-weight: 400;" id="pricingSubtitle">View Our Improvement Plans</p>
                    </div>
                  </div>
                  <button style="background: rgba(255, 255, 255, 0.8); border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease;" id="pricingToggleBtn" onmouseover="this.style.background='rgba(255, 255, 255, 1)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.1)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.8)'; this.style.boxShadow='none'">
                    <i data-lucide="chevron-down" style="width: 20px; height: 20px; transition: transform 0.3s ease;" id="pricingToggleIcon"></i>
                  </button>
                </div>
              </div>
              
              <!-- Collapsible Content -->
              <div id="pricingContent" style="display: none; opacity: 0; transition: all 0.4s ease; margin-top: 2rem;">
                <p style="font-size: 1rem; color: var(--voice-text-secondary); margin: 0.5rem auto 2rem; font-weight: 400; text-align: center; max-width: 500px;">From first insights to complete masteryâ€”grow at your pace with tools designed for real results.</p>
              
              <!-- Premium Pricing Grid -->
              <div style="position: relative; z-index: 1; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; max-width: 1400px; margin: 0 auto;">
                
                <!-- Essential Plan -->
                <div style="background: white; border: 2px solid rgba(0, 0, 0, 0.06); border-radius: 24px; padding: 2.5rem 2rem; text-align: left; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);" onmouseover="this.style.transform='translateY(-12px)'; this.style.boxShadow='0 25px 50px rgba(99, 102, 241, 0.15)'; this.style.borderColor='rgba(99, 102, 241, 0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 20px rgba(0, 0, 0, 0.04)'; this.style.borderColor='rgba(0, 0, 0, 0.06)'">
                  <div style="margin-bottom: 2rem;">
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(99, 102, 241, 0.1); padding: 0.375rem 0.75rem; border-radius: 50px; margin-bottom: 1.5rem;">
                      <i data-lucide="play" style="width: 14px; height: 14px; color: var(--voice-primary);"></i>
                      <span style="font-size: 0.75rem; font-weight: 600; color: var(--voice-primary); text-transform: uppercase; letter-spacing: 0.5px;">Essential</span>
                    </div>
                    <h5 style="font-size: 1.5rem; font-weight: 800; color: var(--voice-text-primary); margin: 0 0 0.5rem 0;">Start Your Growth</h5>
                    <p style="color: var(--voice-text-secondary); font-size: 1rem; margin: 0 0 1.5rem 0; line-height: 1.6;">Perfect for building steady confidence in how you express yourself.</p>
                    <div style="margin-bottom: 2rem;">
                      <span style="font-size: 3rem; font-weight: 900; color: var(--voice-text-primary); line-height: 1;">$9.99</span>
                      <span style="font-size: 1rem; font-weight: 500; color: var(--voice-text-secondary);">/month</span>
                    </div>
                  </div>
                  
                  <div style="margin-bottom: 2rem;">
                    <div style="font-weight: 600; color: var(--voice-text-primary); margin-bottom: 1rem; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px;">What's included:</div>
                    <ul style="list-style: none; padding: 0; margin: 0; space-y: 0.75rem;">
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="check" style="width: 12px; height: 12px; color: var(--voice-success);"></i>
                        </div>
                        <span>10 detailed audio analyses per month</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="check" style="width: 12px; height: 12px; color: var(--voice-success);"></i>
                        </div>
                        <span>Monthly improvement catalog with drills</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="check" style="width: 12px; height: 12px; color: var(--voice-success);"></i>
                        </div>
                        <span>Email support</span>
                      </li>
                    </ul>
                  </div>
                  
                  <button onclick="window.location.href='pricing.html'" style="width: 100%; background: var(--voice-primary); color: white; border: none; padding: 1rem 1.5rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);" onmouseover="this.style.background='#5145db'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(99, 102, 241, 0.35)'" onmouseout="this.style.background='var(--voice-primary)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(99, 102, 241, 0.25)'">Get Started</button>
                </div>
                
                <!-- Max Growth Plan -->
                <div style="background: linear-gradient(135deg, white, #fafbff); border: 3px solid var(--voice-primary); border-radius: 24px; padding: 2.5rem 2rem; text-align: left; position: relative; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; transform: scale(1.05); box-shadow: 0 20px 40px rgba(99, 102, 241, 0.15);" onmouseover="this.style.transform='translateY(-12px) scale(1.08)'; this.style.boxShadow='0 30px 60px rgba(99, 102, 241, 0.25)'" onmouseout="this.style.transform='translateY(0) scale(1.05)'; this.style.boxShadow='0 20px 40px rgba(99, 102, 241, 0.15)'">
                  <!-- Popular Badge -->
                  <div style="position: absolute; top: -1px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, var(--voice-primary), var(--voice-secondary)); color: white; padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.625rem; font-weight: 600; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3); text-transform: uppercase; letter-spacing: 0.5px;">
                    <i data-lucide="star" style="width: 10px; height: 10px; margin-right: 0.2rem;"></i>Popular
                  </div>
                  
                  <div style="margin-bottom: 2rem; margin-top: 1rem;">
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05)); padding: 0.375rem 0.75rem; border-radius: 50px; margin-bottom: 1.5rem;">
                      <i data-lucide="zap" style="width: 14px; height: 14px; color: var(--voice-primary);"></i>
                      <span style="font-size: 0.75rem; font-weight: 600; color: var(--voice-primary); text-transform: uppercase; letter-spacing: 0.5px;">Max Growth</span>
                    </div>
                    <h5 style="font-size: 1.5rem; font-weight: 800; color: var(--voice-text-primary); margin: 0 0 0.5rem 0;">Complete Transformation</h5>
                    <p style="color: var(--voice-text-secondary); font-size: 1rem; margin: 0 0 1.5rem 0; line-height: 1.6;">For serious communicators ready to unlock their full potential with unlimited practice and expert guidance.</p>
                    <div style="margin-bottom: 2rem;">
                      <span style="font-size: 3rem; font-weight: 900; color: var(--voice-text-primary); line-height: 1;">$15.99</span>
                      <span style="font-size: 1rem; font-weight: 500; color: var(--voice-text-secondary);">/month</span>
                    </div>
                  </div>
                  
                  <div style="margin-bottom: 2rem;">
                    <div style="font-weight: 600; color: var(--voice-text-primary); margin-bottom: 1rem; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px;">Everything in Essential, plus:</div>
                    <ul style="list-style: none; padding: 0; margin: 0; space-y: 0.75rem;">
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="infinity" style="width: 12px; height: 12px; color: var(--voice-primary);"></i>
                        </div>
                        <span><strong>Unlimited</strong> audio analysis</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="users" style="width: 12px; height: 12px; color: var(--voice-primary);"></i>
                        </div>
                        <span>Weekly expert review sessions</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="sparkles" style="width: 12px; height: 12px; color: var(--voice-primary);"></i>
                        </div>
                        <span>Full access to Improvement Hub</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="clock" style="width: 12px; height: 12px; color: var(--voice-primary);"></i>
                        </div>
                        <span>Early access to new tools</span>
                      </li>
                    </ul>
                  </div>
                  
                  <button onclick="window.location.href='pricing.html'" style="width: 100%; background: linear-gradient(135deg, var(--voice-primary), var(--voice-secondary)); color: white; border: none; padding: 1rem 1.5rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 12px 30px rgba(99, 102, 241, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 20px rgba(99, 102, 241, 0.4)'">Start Free Trial</button>
                </div>
                
                <!-- Enterprise Plan -->
                <div style="background: white; border: 2px solid rgba(107, 114, 128, 0.15); border-radius: 24px; padding: 2.5rem 2rem; text-align: left; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);" onmouseover="this.style.transform='translateY(-12px)'; this.style.boxShadow='0 25px 50px rgba(107, 114, 128, 0.15)'; this.style.borderColor='rgba(107, 114, 128, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 20px rgba(0, 0, 0, 0.04)'; this.style.borderColor='rgba(107, 114, 128, 0.15)'">
                  <div style="margin-bottom: 2rem;">
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(107, 114, 128, 0.1); padding: 0.375rem 0.75rem; border-radius: 50px; margin-bottom: 1.5rem;">
                      <i data-lucide="building" style="width: 14px; height: 14px; color: var(--voice-text-primary);"></i>
                      <span style="font-size: 0.75rem; font-weight: 600; color: var(--voice-text-primary); text-transform: uppercase; letter-spacing: 0.5px;">Enterprise</span>
                    </div>
                    <h5 style="font-size: 1.5rem; font-weight: 800; color: var(--voice-text-primary); margin: 0 0 0.5rem 0;">Scale Your Team</h5>
                    <p style="color: var(--voice-text-secondary); font-size: 1rem; margin: 0 0 1.5rem 0; line-height: 1.6;">Custom solutions for teams, coaches, and organizations building communication excellence.</p>
                    <div style="margin-bottom: 2rem;">
                      <span style="font-size: 3rem; font-weight: 900; color: var(--voice-text-primary); line-height: 1;">Custom</span>
                      <span style="font-size: 1rem; font-weight: 500; color: var(--voice-text-secondary);"> pricing</span>
                    </div>
                  </div>
                  
                  <div style="margin-bottom: 2rem;">
                    <div style="font-weight: 600; color: var(--voice-text-primary); margin-bottom: 1rem; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px;">Enterprise features:</div>
                    <ul style="list-style: none; padding: 0; margin: 0; space-y: 0.75rem;">
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(107, 114, 128, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="chart-line" style="width: 12px; height: 12px; color: var(--voice-text-primary);"></i>
                        </div>
                        <span>Custom team dashboards & analytics</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(107, 114, 128, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="users-2" style="width: 12px; height: 12px; color: var(--voice-text-primary);"></i>
                        </div>
                        <span>Group metrics & shared insights</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(107, 114, 128, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="headphones" style="width: 12px; height: 12px; color: var(--voice-text-primary);"></i>
                        </div>
                        <span>Dedicated support & onboarding</span>
                      </li>
                    </ul>
                  </div>
                  
                  <button onclick="window.location.href='pricing.html'" style="width: 100%; background: var(--voice-text-primary); color: white; border: none; padding: 1rem 1.5rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 4px 12px rgba(107, 114, 128, 0.25);" onmouseover="this.style.background='#1f2937'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(107, 114, 128, 0.35)'" onmouseout="this.style.background='var(--voice-text-primary)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(107, 114, 128, 0.25)'">Contact Sales</button>
                </div>
                
                <!-- One-Time Plan -->
                <div style="background: white; border: 2px solid rgba(139, 92, 246, 0.15); border-radius: 24px; padding: 2.5rem 2rem; text-align: left; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);" onmouseover="this.style.transform='translateY(-12px)'; this.style.boxShadow='0 25px 50px rgba(139, 92, 246, 0.15)'; this.style.borderColor='rgba(139, 92, 246, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 20px rgba(0, 0, 0, 0.04)'; this.style.borderColor='rgba(139, 92, 246, 0.15)'">
                  <div style="margin-bottom: 2rem;">
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(139, 92, 246, 0.1); padding: 0.375rem 0.75rem; border-radius: 50px; margin-bottom: 1.5rem;">
                      <i data-lucide="file-text" style="width: 14px; height: 14px; color: var(--voice-secondary);"></i>
                      <span style="font-size: 0.75rem; font-weight: 600; color: var(--voice-secondary); text-transform: uppercase; letter-spacing: 0.5px;">One-Time</span>
                    </div>
                    <h5 style="font-size: 1.5rem; font-weight: 800; color: var(--voice-text-primary); margin: 0 0 0.5rem 0;">Personal Blueprint</h5>
                    <p style="color: var(--voice-text-secondary); font-size: 1rem; margin: 0 0 1.5rem 0; line-height: 1.6;">A comprehensive communication analysis and personalized improvement plan delivered as a PDF.</p>
                    <div style="margin-bottom: 2rem;">
                      <span style="font-size: 3rem; font-weight: 900; color: var(--voice-text-primary); line-height: 1;">$30</span>
                      <span style="font-size: 1rem; font-weight: 500; color: var(--voice-text-secondary);"> one-time</span>
                    </div>
                  </div>
                  
                  <div style="margin-bottom: 2rem;">
                    <div style="font-weight: 600; color: var(--voice-text-primary); margin-bottom: 1rem; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px;">What you get:</div>
                    <ul style="list-style: none; padding: 0; margin: 0; space-y: 0.75rem;">
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(139, 92, 246, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="search" style="width: 12px; height: 12px; color: var(--voice-secondary);"></i>
                        </div>
                        <span>Deep analysis of vocal patterns & delivery</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(139, 92, 246, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="target" style="width: 12px; height: 12px; color: var(--voice-secondary);"></i>
                        </div>
                        <span>Targeted breakdown of specific issues</span>
                      </li>
                      <li style="padding: 0.5rem 0; font-size: 0.95rem; color: var(--voice-text-primary); display: flex; align-items: flex-start; gap: 0.75rem; line-height: 1.5;">
                        <div style="width: 20px; height: 20px; background: rgba(139, 92, 246, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                          <i data-lucide="download" style="width: 12px; height: 12px; color: var(--voice-secondary);"></i>
                        </div>
                        <span>Lifetime PDF accessâ€”yours forever</span>
                      </li>
                    </ul>
                  </div>
                  
                  <button onclick="window.location.href='pricing.html'" style="width: 100%; background: var(--voice-secondary); color: white; border: none; padding: 1rem 1.5rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.25);" onmouseover="this.style.background='#7c3aed'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(139, 92, 246, 0.35)'" onmouseout="this.style.background='var(--voice-secondary)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(139, 92, 246, 0.25)'">Get My Report</button>
                </div>
                
              </div>
              
              </div>
            </div>
            
            <!-- Enhanced Action Section -->
            <div style="margin-top: 3rem; text-align: center; padding: 3rem 2rem; background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(248, 250, 252, 0.9)); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);">
              <div style="max-width: 600px; margin: 0 auto 2rem;">
                <h4 style="font-size: 1.5rem; font-weight: 700; color: var(--voice-text-primary); margin: 0 0 0.75rem 0;">Ready to Continue Your Growth?</h4>
                <p style="color: var(--voice-text-secondary); line-height: 1.6; margin: 0; font-size: 1rem;">Keep building on these insights or explore more tools to accelerate your communication mastery.</p>
              </div>
              
              <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; max-width: 500px; margin: 0 auto;">
                <button onclick="window.location.href='storytelling-analysis.html'" 
                  style="background: linear-gradient(135deg, var(--voice-primary), var(--voice-secondary)); color: white; border: none; padding: 1rem 2rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); flex: 1; min-width: 200px;"
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(99, 102, 241, 0.4)'"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(99, 102, 241, 0.3)'">
                  <i data-lucide="mic" style="width: 16px; height: 16px; margin-right: 0.5rem; vertical-align: middle;"></i>
                  Practice Again
                </button>
                <button onclick="window.location.href='improvement-hub.html'" 
                  style="background: white; color: var(--voice-primary); border: 2px solid var(--voice-primary); padding: 1rem 2rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; flex: 1; min-width: 200px;"
                  onmouseover="this.style.background='var(--voice-primary)'; this.style.color='white'; this.style.transform='translateY(-2px)'"
                  onmouseout="this.style.background='white'; this.style.color='var(--voice-primary)'; this.style.transform='translateY(0)'">
                  <i data-lucide="sparkles" style="width: 16px; height: 16px; margin-right: 0.5rem; vertical-align: middle;"></i>
                  Explore Improvement Hub
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // CRITICAL: Set up Gemini API key for transcription
      window.GEMINI_API_KEY = "AIzaSyBGvwarFw2FbxgxOMnFchyji6G-zYkrgV8";
      console.log("ðŸ”‘ Gemini API key configured for storytelling analysis");

      // Toggle pricing section
      function togglePricingSection() {
        const content = document.getElementById('pricingContent');
        const icon = document.getElementById('pricingToggleIcon');
        const subtitle = document.getElementById('pricingSubtitle');
        const button = document.getElementById('pricingToggleBtn');
        
        if (content.style.display === 'none' || content.style.display === '') {
          // Show content
          content.style.display = 'block';
          setTimeout(() => {
            content.style.opacity = '1';
            content.style.transform = 'translateY(0)';
          }, 10);
          icon.style.transform = 'rotate(180deg)';
          subtitle.textContent = 'Click to collapse pricing options';
          button.style.background = 'var(--voice-primary)';
          button.style.borderColor = 'var(--voice-primary)';
          icon.style.color = 'white';
        } else {
          // Hide content
          content.style.opacity = '0';
          content.style.transform = 'translateY(-20px)';
          setTimeout(() => {
            content.style.display = 'none';
          }, 400);
          icon.style.transform = 'rotate(0deg)';
          subtitle.textContent = 'View Our Improvement Plans';
          button.style.background = 'rgba(255, 255, 255, 0.8)';
          button.style.borderColor = 'rgba(0, 0, 0, 0.1)';
          icon.style.color = 'var(--voice-text-primary)';
        }
        
        // Re-initialize lucide icons
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
        }
      }

      // Storytelling Metrics Configuration
      const storytellingMetrics = {
        quantitative: {
          'Narrative Pace': { weight: 0.15, optimal: { min: 100, max: 140 } },
          'Story Structure': { weight: 0.25, optimal: { min: 80, max: 100 } },
          'Filler Words': { weight: 0.10, optimal: { min: 0, max: 2 } },
          'Emotional Words': { weight: 0.15, optimal: { min: 8, max: 20 } },
          'Pause Timing': { weight: 0.15, optimal: { min: 2, max: 5 } },
          'Vivid Descriptions': { weight: 0.10, optimal: { min: 5, max: 15 } },
          'Story Length': { weight: 0.10, optimal: { min: 180, max: 480 } }
        },
        qualitative: {
          'Emotional Impact': { weight: 0.30, factors: ['resonance', 'empathy', 'connection'] },
          'Narrative Structure': { weight: 0.25, factors: ['clear beginning', 'engaging middle', 'satisfying end'] },
          'Character Development': { weight: 0.25, factors: ['relatable characters', 'clear motivations', 'growth'] },
          'Engagement & Delivery': { weight: 0.20, factors: ['compelling voice', 'pacing', 'audience connection'] }
        }
      };

      // Unified tab switching functionality
      function initializeUnifiedTabSwitching() {
        const tabButtons = document.querySelectorAll('.unified-tab-btn');
        const tabPanes = document.querySelectorAll('.unified-tab-pane');
        
        tabButtons.forEach(button => {
          button.addEventListener('click', () => {
            const targetTab = button.dataset.tab;
            
            // Update active tab button
            tabButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            // Update active tab pane
            tabPanes.forEach(pane => pane.classList.remove('active'));
            document.getElementById(targetTab + '-pane').classList.add('active');
          });
        });
      }

      // Transcribe audio using Gemini AI
      async function transcribeAudioWithGemini(audioFile) {
        try {
          console.log("ðŸŽ¤ Transcribing storytelling audio with Gemini...");
          
          // Get API key from config
          const apiKey = window.API_CONFIG?.gemini || window.GEMINI_API_KEY;
          if (!apiKey || apiKey === 'YOUR_GEMINI_API_KEY_HERE') {
            throw new Error("Gemini API key not configured");
          }
          
          const arrayBuffer = await audioFile.arrayBuffer();
          const base64Audio = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
          
          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              contents: [{
                parts: [
                  {
                    text: "Please transcribe this storytelling audio file accurately. Return only the transcribed text without any additional commentary."
                  },
                  {
                    inline_data: {
                      mime_type: audioFile.type,
                      data: base64Audio
                    }
                  }
                ]
              }],
              generationConfig: {
                temperature: 0.1,
                maxOutputTokens: 8000,
                topP: 0.8,
                topK: 40
              }
            })
          });

          // Check for HTTP errors
          if (!response.ok) {
            const errorText = await response.text();
            console.error(`âŒ Gemini API error: ${response.status} - ${response.statusText}`, errorText);
            
            // Handle specific error cases
            if (response.status === 503) {
              throw new Error("Gemini service is temporarily unavailable. Please try again in a few moments.");
            } else if (response.status === 429) {
              throw new Error("Rate limit exceeded. Please try again later.");
            } else if (response.status === 401) {
              throw new Error("Invalid API key. Please check your Gemini API configuration.");
            } else {
              throw new Error(`Gemini API error: ${response.status} - ${response.statusText}`);
            }
          }

          const data = await response.json();
          
          if (data.candidates && data.candidates[0] && data.candidates[0].content) {
            const transcript = data.candidates[0].content.parts[0].text;
            console.log("âœ… Storytelling transcription successful");
            return transcript;
          } else {
            console.error("âŒ Invalid Gemini API response structure:", data);
            throw new Error("No transcription received from Gemini");
          }
        } catch (error) {
          console.error("âŒ Transcription error:", error);
          
          // Provide fallback demo transcript for development/testing
          if (error.message.includes("503") || error.message.includes("service unavailable")) {
            console.log("ðŸ”„ Providing fallback demo transcript due to service unavailability");
            return getStorytellingDemoTranscript();
          }
          
          throw new Error(`Transcription failed: ${error.message}`);
        }
      }

      // Fallback demo transcript for storytelling conversations
      function getStorytellingDemoTranscript() {
        return `You want to hear about the craziest thing that happened to me last week? I still can't believe it actually happened.

Oh definitely! I love a good story. What happened?

So I was running late for this important job interview downtown, right? I'm rushing to catch the subway, and I accidentally grabbed my roommate's backpack instead of mine.

Oh no! Did you realize it right away?

Not until I got to the interview and reached for my portfolio. Instead, I pull out... my roommate's pet iguana costume. Like, a full-on, green, scaly iguana suit.

You're kidding me! What did you do?

Well, I panicked for like two seconds. Then I looked at the receptionist, who was trying so hard not to laugh, and I just said, 'Well, I guess this shows I'm adaptable and ready for anything!'

That's amazing! How did the interviewer react?

The best part is, when I explained what happened, the interviewer started laughing so hard they had tears in their eyes. Turns out, they were having a terrible day and needed a good laugh.

Did you get the job?

Not only did I get the job, but they said my ability to handle unexpected situations with humor was exactly what they were looking for. And now the iguana costume is kind of a legend in the office.

That's incredible! It just goes to show that sometimes the worst situations can turn into the best opportunities.`;
      }

      // Analyze storytelling using specific metrics
      async function analyzeStorytelling(transcript) {
        try {
          console.log("ðŸ§  Analyzing storytelling performance...");
          
          const quantitativeScores = await calculateQuantitativeMetrics(transcript, storytellingMetrics.quantitative);
          const qualitativeScores = await calculateQualitativeMetrics(transcript, storytellingMetrics.qualitative);
          const overallScore = calculateOverallScore(quantitativeScores, qualitativeScores);
          const insights = await generateStorytellingInsights(transcript, quantitativeScores, qualitativeScores);
          
          return {
            transcript: transcript,
            analysisType: "storytelling",
            quantitativeScores: quantitativeScores,
            qualitativeScores: qualitativeScores,
            overallScore: overallScore,
            insights: insights
          };
        } catch (error) {
          console.error("âŒ Storytelling analysis error:", error);
          throw new Error(`Analysis failed: ${error.message}`);
        }
      }

      // Calculate quantitative metrics for storytelling
      async function calculateQuantitativeMetrics(transcript, quantitativeConfig) {
        const words = transcript.split(/\s+/).filter(word => word.length > 0);
        const sentences = transcript.split(/[.!?]+/).filter(s => s.trim().length > 0);
        
        const metrics = {};
        
        // Narrative Pace (words per minute for storytelling)
        const estimatedDurationMinutes = words.length / 120; // Storytelling pace
        metrics['Narrative Pace'] = Math.round(words.length / estimatedDurationMinutes);
        
        // Story Structure (estimated based on narrative elements)
        const storyElements = ['once', 'then', 'suddenly', 'finally', 'because', 'so', 'however', 'meanwhile'];
        const structureScore = storyElements.filter(element => 
          transcript.toLowerCase().includes(element)
        ).length * 10;
        metrics['Story Structure'] = Math.min(100, structureScore);
        
        // Filler Words (should be minimal in stories)
        const fillerWords = ['um', 'uh', 'like', 'you know', 'so', 'well'];
        metrics['Filler Words'] = words.filter(word => 
          fillerWords.includes(word.toLowerCase())
        ).length;
        
        // Emotional Words
        const emotionalWords = ['felt', 'excited', 'scared', 'happy', 'sad', 'angry', 'surprised', 'amazed', 'worried', 'proud', 'embarrassed', 'grateful'];
        metrics['Emotional Words'] = words.filter(word => 
          emotionalWords.some(emo => word.toLowerCase().includes(emo))
        ).length;
        
        // Pause Timing (estimated)
        metrics['Pause Timing'] = 3; // Default appropriate pause timing
        
        // Vivid Descriptions
        const descriptiveWords = ['beautiful', 'huge', 'tiny', 'bright', 'dark', 'loud', 'quiet', 'smooth', 'rough', 'sweet', 'bitter', 'warm', 'cold'];
        metrics['Vivid Descriptions'] = words.filter(word => 
          descriptiveWords.some(desc => word.toLowerCase().includes(desc))
        ).length;
        
        // Story Length
        metrics['Story Length'] = Math.round(words.length * 0.4); // Estimated seconds
        
        return metrics;
      }

      // Calculate qualitative metrics using AI analysis
      async function calculateQualitativeMetrics(transcript, qualitativeConfig) {
        try {
          const prompt = `Analyze this storytelling transcript for narrative effectiveness. Rate each factor from 1-10:

Emotional Impact: Evaluate based on resonance, empathy, connection
Narrative Structure: Evaluate based on clear beginning, engaging middle, satisfying end
Character Development: Evaluate based on relatable characters, clear motivations, growth
Engagement & Delivery: Evaluate based on compelling voice, pacing, audience connection

Transcript: "${transcript}"

Provide scores in this exact format:
Emotional Impact: [score 1-10]
Narrative Structure: [score 1-10]
Character Development: [score 1-10]
Engagement & Delivery: [score 1-10]`;

          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${window.GEMINI_API_KEY}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              contents: [{
                parts: [{
                  text: prompt
                }]
              }]
            })
          });

          const data = await response.json();
          const analysisText = data.candidates[0].content.parts[0].text;
          
          const scores = {};
          Object.keys(qualitativeConfig).forEach(metric => {
            const match = analysisText.match(new RegExp(`${metric}:\\s*(\\d+)`, 'i'));
            scores[metric] = match ? parseInt(match[1]) : 3; // Realistic default of 3/10
          });
          
          return scores;
        } catch (error) {
          console.error("Error calculating qualitative metrics:", error);
          const defaultScores = {};
          Object.keys(qualitativeConfig).forEach(metric => {
            defaultScores[metric] = 3; // Realistic default of 3/10
          });
          return defaultScores;
        }
      }

      // Calculate overall score
      function calculateOverallScore(quantitativeScores, qualitativeScores) {
        const qualitativeWeight = 0.7; // More weight on qualitative for storytelling
        const quantitativeWeight = 0.3;
        
        const qualitativeValues = Object.values(qualitativeScores);
        const qualitativeAvg = qualitativeValues.reduce((a, b) => a + b, 0) / qualitativeValues.length;
        
        // Calculate quantitative average from actual metrics
        const quantitativeMetrics = Object.entries(quantitativeScores).map(([metric, value]) => {
          const config = storytellingMetrics.quantitative[metric];
          if (!config) return 5; // Default middle score
          
          const { optimal } = config;
          // Score based on how close to optimal range
          if (value >= optimal.min && value <= optimal.max) {
            return 8; // Great score
          } else if (value < optimal.min) {
            return Math.max(3, 8 - ((optimal.min - value) / optimal.min) * 5);
          } else {
            return Math.max(3, 8 - ((value - optimal.max) / optimal.max) * 5);
          }
        });
        
        const quantitativeAvg = quantitativeMetrics.reduce((a, b) => a + b, 0) / quantitativeMetrics.length;
        
        const overallScore = (qualitativeAvg * qualitativeWeight + quantitativeAvg * quantitativeWeight);
        return Math.round(overallScore * 10) / 10;
      }

      // Generate storytelling insights
      async function generateStorytellingInsights(transcript, quantitativeScores, qualitativeScores) {
        try {
          const prompt = `Analyze this storytelling performance and provide detailed feedback in this exact format:

STRENGTHS:
â€¢ [List 3-4 specific strengths in storytelling]

AREAS FOR IMPROVEMENT:
â€¢ [List 3-4 specific areas to improve in storytelling]

RECOMMENDATIONS:
â€¢ [List 3-4 actionable recommendations for better storytelling]

Transcript: "${transcript}"

Focus on emotional impact, narrative structure, character development, and delivery.`;

          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${window.GEMINI_API_KEY}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              contents: [{
                parts: [{
                  text: prompt
                }]
              }]
            })
          });

          const data = await response.json();
          return data.candidates[0].content.parts[0].text;
        } catch (error) {
          console.error("Error generating insights:", error);
          return `STRENGTHS:
â€¢ Attempted to tell a complete story
â€¢ Showed creativity and imagination
â€¢ Engaged with the storytelling process
â€¢ Demonstrated basic narrative skills

AREAS FOR IMPROVEMENT:
â€¢ Develop stronger emotional connections with audience
â€¢ Improve story structure and pacing
â€¢ Enhance character development and descriptions
â€¢ Practice more engaging delivery techniques

RECOMMENDATIONS:
â€¢ Study classic story structures and apply them to your narratives
â€¢ Practice using vivid, sensory descriptions to paint pictures
â€¢ Work on varying your pace and using strategic pauses
â€¢ Focus on creating relatable characters with clear motivations`;
        }
      }

      // Display results functions
      function displayResults(results) {
        console.log("ðŸŽ¨ Displaying storytelling results:", results);
        
        if (results.transcript) {
          document.getElementById('transcriptContent').innerHTML = `
            <div class="transcript-text">
              ${results.transcript}
            </div>
          `;
        }

        displayDetailedInsights(results.insights, results.overallScore);
        displayQuantitativeMetrics(results.quantitativeScores);
        displayQualitativeMetrics(results.qualitativeScores);
      }

      function displayDetailedInsights(insights, overallScore) {
        const insightsElement = document.getElementById('detailedAnalysisContent');
        if (!insightsElement || !insights) return;

        const sections = ['STRENGTHS:', 'AREAS FOR IMPROVEMENT:', 'RECOMMENDATIONS:'];
        let insightsHtml = '';

        // Overall Performance Assessment
        let performanceHtml = '';
        let performanceColor = '';
        let performanceIcon = '';
        
        if (overallScore >= 8) {
          performanceHtml = `
            <div style="margin-bottom: 1.5rem;">
              <span style="display: inline-block; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.875rem;">
                Score: ${Math.round(overallScore * 10)}/100
              </span>
            </div>
            <h4 style="font-size: 1.25rem; font-weight: 700; color: var(--voice-text-primary); margin-bottom: 1rem;">
              Masterful Storytelling
            </h4>
            <p style="color: var(--voice-text-secondary); line-height: 1.7; margin-bottom: 1.5rem;">
              You demonstrate exceptional storytelling abilities with powerful narrative structure, emotional depth, and captivating delivery. Your stories create lasting impact on your audience.
            </p>
            <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.2);">
              <p style="font-weight: 600; color: var(--voice-text-primary); margin-bottom: 0.5rem;">Key Strengths Observed:</p>
              <p style="color: var(--voice-text-secondary); margin: 0;">
                Emotional resonance â€¢ Compelling structure â€¢ Vivid imagery â€¢ Engaging delivery
              </p>
            </div>
          `;
          performanceColor = 'excellent';
          performanceIcon = 'check-circle';
        } else if (overallScore >= 6.5) {
          performanceHtml = `
            <div style="margin-bottom: 1.5rem;">
              <span style="display: inline-block; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.875rem;">
                Score: ${Math.round(overallScore * 10)}/100
              </span>
            </div>
            <h4 style="font-size: 1.25rem; font-weight: 700; color: var(--voice-text-primary); margin-bottom: 1rem;">
              Developing Storytelling Skills
            </h4>
            <p style="color: var(--voice-text-secondary); line-height: 1.7; margin-bottom: 1.5rem;">
              You show good storytelling instincts with solid fundamentals. With focused practice on specific narrative techniques, you can become a truly compelling storyteller.
            </p>
            <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(245, 158, 11, 0.2);">
              <p style="font-weight: 600; color: var(--voice-text-primary); margin-bottom: 0.5rem;">Focus Areas:</p>
              <p style="color: var(--voice-text-secondary); margin: 0;">
                Emotional depth â€¢ Narrative structure â€¢ Character development â€¢ Delivery techniques
              </p>
            </div>
          `;
          performanceColor = 'good';
          performanceIcon = 'trending-up';
        } else {
          performanceHtml = `
            <div style="margin-bottom: 1.5rem;">
              <span style="display: inline-block; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.875rem;">
                Score: ${Math.round(overallScore * 10)}/100
              </span>
            </div>
            <h4 style="font-size: 1.25rem; font-weight: 700; color: var(--voice-text-primary); margin-bottom: 1rem;">
              Storytelling Journey Begins
            </h4>
            <p style="color: var(--voice-text-secondary); line-height: 1.7; margin-bottom: 1.5rem;">
              Every great storyteller starts somewhere. Your willingness to practice and receive feedback puts you on the path to developing powerful narrative skills.
            </p>
            <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(239, 68, 68, 0.2);">
              <p style="font-weight: 600; color: var(--voice-text-primary); margin-bottom: 0.5rem;">Building Blocks:</p>
              <p style="color: var(--voice-text-secondary); margin: 0;">
                Story structure â€¢ Emotional connection â€¢ Character creation â€¢ Delivery confidence
              </p>
            </div>
          `;
          performanceColor = 'needs-improvement';
          performanceIcon = 'alert-circle';
        }

        insightsHtml += `
          <div class="insight-card-modern performance">
            <div class="insight-header-modern">
              <div class="insight-icon-modern ${performanceColor}">
                <i data-lucide="${performanceIcon}"></i>
              </div>
              <h4 class="insight-title-modern">Overall Assessment</h4>
            </div>
            <div class="insight-content-modern">
              ${performanceHtml}
            </div>
          </div>
        `;

        sections.forEach(section => {
          const match = insights.match(new RegExp(`${section}([\\s\\S]*?)(?=${sections.find(s => s !== section) || '$'})`, 'i'));
          if (match) {
            const content = match[1].trim();
            const title = section.replace(':', '');
            let color = 'var(--voice-primary)';
            let icon = 'lightbulb';
            
            if (section.includes('STRENGTHS')) {
              color = 'var(--voice-success)';
              icon = 'check-circle';
            } else if (section.includes('IMPROVEMENT')) {
              color = 'var(--voice-warm)';
              icon = 'alert-triangle';
            } else if (section.includes('RECOMMENDATIONS')) {
              color = 'var(--voice-primary)';
              icon = 'compass';
            }
            
            insightsHtml += `
              <div class="insight-card-modern">
                <div class="insight-header-modern">
                  <div class="insight-icon-modern" style="background: ${color};">
                    <i data-lucide="${icon}"></i>
                  </div>
                  <h4 class="insight-title-modern">${title}</h4>
                </div>
                <div class="insight-content-modern">
                  ${content.replace(/â€¢/g, '&bull;')}
                </div>
              </div>
            `;
          }
        });

        insightsElement.innerHTML = insightsHtml;

        // Update score display
        document.getElementById('scoreCircle').textContent = Math.round(overallScore * 10);
        document.getElementById('scoreText').textContent = `${Math.round(overallScore * 10)}/100`;
        
        if (overallScore >= 8) {
          document.getElementById('scoreDescription').textContent = "Exceptional storytelling with captivating narrative and emotional depth";
        } else if (overallScore >= 6.5) {
          document.getElementById('scoreDescription').textContent = "Strong storytelling foundation with clear areas for enhancement";
        } else {
          document.getElementById('scoreDescription').textContent = "Beginning storyteller with significant potential for growth";
        }
      }

      function displayQuantitativeMetrics(scores) {
        const quantitativeElement = document.getElementById('quantitativeContent');
        if (!quantitativeElement || !scores) return;

        let html = '<div class="metrics-grid">';
        
        Object.entries(scores).forEach(([metric, value]) => {
          const config = storytellingMetrics.quantitative[metric] || { optimal: { min: 0, max: 100 } };
          const optimal = config.optimal;
          
          let score;
          if (value >= optimal.min && value <= optimal.max) {
            score = 100;
          } else if (value < optimal.min) {
            score = Math.max(0, 100 - (optimal.min - value) * 2);
          } else {
            score = Math.max(0, 100 - (value - optimal.max) * 2);
          }
          
          score = Math.min(100, Math.max(0, score));
          const scoreColor = score >= 80 ? '#10b981' : score >= 60 ? '#f59e0b' : score >= 40 ? '#ef4444' : '#dc2626';
          
          html += `
            <div class="metric-card">
              <div class="metric-header">
                <span class="metric-name">${metric}</span>
                <span class="metric-score" style="color: ${scoreColor};">${Math.round(score)}/100</span>
              </div>
              <div class="metric-details">
                <div style="font-weight: 500;">Measured: ${value}${getMetricUnit(metric)}</div>
                <div style="color: var(--voice-text-muted);">Optimal: ${optimal.min}-${optimal.max}${getMetricUnit(metric)}</div>
              </div>
              <div class="metric-bar">
                <div class="metric-fill" style="width: ${score}%; background-color: ${scoreColor};"></div>
              </div>
            </div>
          `;
        });
        
        html += '</div>';
        quantitativeElement.innerHTML = html;
      }

      function displayQualitativeMetrics(scores) {
        const qualitativeElement = document.getElementById('qualitativeContent');
        if (!qualitativeElement || !scores) return;

        let html = '<div class="categories-grid">';
        
        Object.entries(scores).forEach(([metric, score]) => {
          const config = storytellingMetrics.qualitative[metric] || { factors: [] };
          const normalizedScore = (score / 10) * 100;
          const scoreColor = normalizedScore >= 80 ? '#10b981' : normalizedScore >= 60 ? '#f59e0b' : normalizedScore >= 40 ? '#ef4444' : '#dc2626';
          
          html += `
            <div class="category-card">
              <div class="category-header">
                <span class="category-name">${metric}</span>
                <span class="category-score" style="color: ${scoreColor};">${score}/10</span>
              </div>
              <div class="category-factors">
                ${config.factors.map(factor => `<span class="factor-tag">${factor}</span>`).join('')}
              </div>
              <div class="category-bar">
                <div class="category-fill" style="width: ${normalizedScore}%; background-color: ${scoreColor};"></div>
              </div>
            </div>
          `;
        });
        
        html += '</div>';
        qualitativeElement.innerHTML = html;
      }

      function getMetricUnit(metric) {
        const units = {
          'Narrative Pace': ' wpm',
          'Story Structure': '%',
          'Filler Words': '',
          'Emotional Words': '',
          'Pause Timing': 's',
          'Vivid Descriptions': '',
          'Story Length': 's'
        };
        return units[metric] || '';
      }

      // Copy functions
      function copyAnalysis() {
        const analysisContent = document.getElementById('detailedAnalysisContent');
        if (analysisContent) {
          const textContent = analysisContent.innerText;
          navigator.clipboard.writeText(textContent);
          
          // Show feedback
          const btn = event.target.closest('.copy-btn');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i data-lucide="check"></i> Copied!';
          btn.style.background = 'var(--voice-success)';
          btn.style.color = 'white';
          
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = 'rgba(255, 255, 255, 0.6)';
            btn.style.color = 'var(--voice-text-secondary)';
          }, 2000);
        }
      }

      function copyQuantitative() {
        const quantContent = document.getElementById('quantitativeContent');
        if (quantContent) {
          const textContent = quantContent.innerText;
          navigator.clipboard.writeText(textContent);
          
          // Show feedback
          const btn = event.target.closest('.copy-btn');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i data-lucide="check"></i> Copied!';
          btn.style.background = 'var(--voice-success)';
          btn.style.color = 'white';
          
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = 'rgba(255, 255, 255, 0.6)';
            btn.style.color = 'var(--voice-text-secondary)';
          }, 2000);
        }
      }

      function copyQualitative() {
        const qualContent = document.getElementById('qualitativeContent');
        if (qualContent) {
          const textContent = qualContent.innerText;
          navigator.clipboard.writeText(textContent);
          
          // Show feedback
          const btn = event.target.closest('.copy-btn');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i data-lucide="check"></i> Copied!';
          btn.style.background = 'var(--voice-success)';
          btn.style.color = 'white';
          
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = 'rgba(255, 255, 255, 0.6)';
            btn.style.color = 'var(--voice-text-secondary)';
          }, 2000);
        }
      }

      // Process audio for transcription
      async function processAudioForTranscription(audioDataString) {
        try {
          console.log("ðŸŽ¤ Processing storytelling audio for transcription");

          const audioData = JSON.parse(audioDataString);
          console.log("ðŸ“Š Audio data:", audioData);

          const response = await fetch(audioData.base64);
          const blob = await response.blob();
          const audioFile = new File([blob], audioData.name, { type: audioData.type });

          const transcript = await transcribeAudioWithGemini(audioFile);
          const analysisResults = await analyzeStorytelling(transcript);

          console.log("âœ… Storytelling analysis complete:", analysisResults);
          displayResults(analysisResults);

        } catch (error) {
          console.error("âŒ Audio processing failed:", error);
          document.getElementById("transcriptContent").innerHTML = `
            <div style="text-align: center; padding: 2rem; background: #fef2f2; border: 2px solid #fca5a5; border-radius: 12px; color: #dc2626;">
              <h3>âš ï¸ Analysis Failed</h3>
              <p>Unable to process your story. Please try again.</p>
              <p style="font-size: 14px; opacity: 0.8;">Error: ${error.message}</p>
            </div>
          `;
        }
      }

              // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        lucide.createIcons();
        initializeUnifiedTabSwitching();

        const audioData = sessionStorage.getItem("audioForAnalysis");
        if (audioData) {
          console.log("ðŸŽ¤ Found audio data for storytelling analysis");
          processAudioForTranscription(audioData);
          sessionStorage.removeItem("audioForAnalysis");
        } else {
          console.log("âŒ No audio data found");
          document.getElementById("transcriptContent").innerHTML = `
            <div style="text-align: center; padding: 2rem;">
              <h3>No Audio Data</h3>
              <p>Please record a story first.</p>
              <a href="storytelling-analysis.html" class="back-btn" style="margin-top: 1rem;">
                Start Recording
              </a>
            </div>
          `;
        }

        // User dropdown functionality
        const userMenuBtn = document.getElementById("userMenuBtn");
        const userDropdown = document.getElementById("userDropdown");

        if (userMenuBtn && userDropdown) {
          userMenuBtn.addEventListener("click", (e) => {
            e.preventDefault();
            userDropdown.classList.toggle("hidden");
          });

          // Close dropdown when clicking outside
          document.addEventListener("click", (e) => {
            if (!userMenuBtn.contains(e.target) && !userDropdown.contains(e.target)) {
              userDropdown.classList.add("hidden");
            }
          });

          // Handle logout
          const logoutBtn = document.getElementById("logoutBtn");
          if (logoutBtn) {
            logoutBtn.addEventListener("click", () => {
              // Clear any stored session data
              localStorage.clear();
              sessionStorage.clear();
              
              // Redirect to login page
              window.location.href = "login.html";
            });
          }
        }
      });
    </script>
  </body>
</html>